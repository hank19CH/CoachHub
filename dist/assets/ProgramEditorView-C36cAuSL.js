import{d as U,u as X,m as Z,s as c,c as r,a as t,y as I,t as d,F as w,n as _,b as g,f as p,h as q,i as L,g as A,k as ee,r as u,q as te,j as oe,o as a,l as se}from"./index-CR_8Ibs2.js";import{_ as re}from"./ConfirmDialog.vue_vue_type_script_setup_true_lang-DVidb-Rq.js";import{_ as ae}from"./Toast.vue_vue_type_script_setup_true_lang-C6u_wdkL.js";const ne={class:"pb-20"},le={class:"sticky top-0 z-10 bg-white border-b border-feed-border px-4 py-3"},ie={class:"flex items-center gap-3"},ue={class:"flex-1 min-w-0"},de={class:"font-display text-lg font-bold text-gray-900 truncate"},ce={class:"text-sm text-gray-500"},me={key:0,class:"p-6"},ve={class:"animate-pulse space-y-4"},fe={class:"grid grid-cols-7 gap-2"},ge={key:1,class:"p-4 space-y-6"},pe={key:0,class:"card p-4"},ke={class:"text-sm text-gray-700"},we={key:1,class:"card p-4 bg-blue-50 border border-blue-200"},_e={class:"text-sm text-blue-800"},ye={class:"font-semibold text-gray-900"},he={class:"grid grid-cols-7 gap-2"},be=["onClick"],xe={class:"text-xs text-summit-700 font-medium"},Ce={class:"text-xs font-semibold text-gray-900 line-clamp-2 leading-tight"},We=["onClick"],Ee=["onClick"],$e={class:"text-xs font-medium"},qe={class:"bg-white w-full sm:max-w-lg sm:rounded-2xl rounded-t-2xl max-h-[70vh] flex flex-col animate-slide-up"},Re={class:"flex-1 overflow-y-auto p-4 space-y-2"},je={key:0,class:"text-center py-8 text-gray-500"},Me=["onClick"],Te={class:"font-semibold text-gray-900 mb-1"},De={key:0,class:"text-sm text-gray-600 line-clamp-2"},Pe={key:1,class:"text-xs text-gray-500 mt-1"},ze=U({__name:"ProgramEditorView",setup(Se){const H=se(),R=ee(),v=X(),f=u(null),k=u([]),y=u([]),B=u(!0),j=u(!1),h=u(null),b=u(null),x=u(!1),C=u(null),M=u(!1),F=u(""),V=u("success"),T=u(!1);function W(o,e="success"){F.value=o,V.value=e,T.value=!0}const D=te(()=>H.params.id),z=[{value:1,label:"Monday"},{value:2,label:"Tuesday"},{value:3,label:"Wednesday"},{value:4,label:"Thursday"},{value:5,label:"Friday"},{value:6,label:"Saturday"},{value:7,label:"Sunday"}];Z(async()=>{await P(),await Y()});async function P(){if(v.user)try{const{data:o,error:e}=await c.from("programs").select("*").eq("id",D.value).eq("coach_id",v.user.id).single();if(e)throw e;f.value=o;const{data:n,error:s}=await c.from("program_weeks").select("*").eq("program_id",D.value).order("week_number");if(s)throw s;if(n&&n.length>0){const l=await Promise.all(n.map(async m=>{const{data:$}=await c.from("workouts").select("*").eq("program_week_id",m.id).order("day_of_week");return{...m,workouts:$||[]}}));k.value=l}else await O()}catch(o){console.error("Error loading program:",o),R.push("/programs")}finally{B.value=!1}}async function O(){if(f.value)try{const o=[];for(let s=1;s<=(f.value.duration_weeks??0);s++)o.push({program_id:D.value,week_number:s,name:`Week ${s}`});const{data:e,error:n}=await c.from("program_weeks").insert(o).select();if(n)throw n;k.value=(e||[]).map(s=>({...s,workouts:[]}))}catch(o){console.error("Error initializing weeks:",o)}}async function Y(){if(v.user)try{const{data:o,error:e}=await c.from("workouts").select("*").eq("coach_id",v.user.id).is("program_week_id",null).order("name");if(e)throw e;y.value=o||[]}catch(o){console.error("Error loading workouts:",o)}}function G(o,e){h.value=o,b.value=e,j.value=!0}function S(){j.value=!1,h.value=null,b.value=null}async function J(o){if(!(!h.value||b.value===null))try{const{data:e,error:n}=await c.from("workouts").insert({coach_id:v.user.id,program_week_id:h.value,name:o.name,description:o.description,day_of_week:b.value,estimated_duration_min:o.estimated_duration_min,workout_type:o.workout_type,is_template:!1}).select().single();if(n)throw n;const{data:s,error:l}=await c.from("exercises").select("*").eq("workout_id",o.id).order("order_index");if(l)throw l;if(s&&s.length>0){const m=s.map(i=>({workout_id:e.id,name:i.name,description:i.description,order_index:i.order_index,sets:i.sets,reps:i.reps,weight_kg:i.weight_kg,duration_seconds:i.duration_seconds,distance_meters:i.distance_meters,rpe:i.rpe,intensity_percent:i.intensity_percent,target_time_seconds:i.target_time_seconds,rest_seconds:i.rest_seconds,notes:i.notes,video_url:i.video_url})),{error:$}=await c.from("exercises").insert(m);if($)throw $}await P(),S(),W("Workout assigned")}catch(e){console.error("Error assigning workout:",e),W("Failed to assign workout","error")}}function K(o){C.value=o,x.value=!0}async function Q(){if(C.value){M.value=!0;try{const{error:o}=await c.from("workouts").delete().eq("id",C.value).eq("coach_id",v.user.id);if(o)throw o;x.value=!1,C.value=null,await P(),W("Workout removed")}catch(o){console.error("Error removing workout:",o),W("Failed to remove workout","error")}finally{M.value=!1}}}function E(o,e){return o.workouts?.find(n=>n.day_of_week===e)}function N(o){const e=z.find(n=>n.value===o);return e?e.label.substring(0,3):""}return(o,e)=>{const n=oe("router-link");return a(),r("div",ne,[t("div",le,[t("div",ie,[t("button",{onClick:e[0]||(e[0]=s=>I(R).push("/programs")),class:"p-2 hover:bg-gray-100 rounded-lg -ml-2"},[...e[3]||(e[3]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 19l-7-7 7-7"})],-1)])]),t("div",ue,[t("h1",de,d(f.value?.name||"Program"),1),t("p",ce,d(k.value.length)+" week"+d(k.value.length!==1?"s":""),1)])])]),B.value?(a(),r("div",me,[t("div",ve,[(a(),r(w,null,_(3,s=>t("div",{key:s},[e[4]||(e[4]=t("div",{class:"h-6 bg-gray-200 rounded w-32 mb-3"},null,-1)),t("div",fe,[(a(),r(w,null,_(7,l=>t("div",{key:l,class:"h-20 bg-gray-100 rounded"})),64))])])),64))])])):(a(),r("div",ge,[f.value?.description?(a(),r("div",pe,[t("p",ke,d(f.value.description),1)])):g("",!0),y.value.length===0?(a(),r("div",we,[t("p",_e,[e[6]||(e[6]=p(" ðŸ’¡ ",-1)),e[7]||(e[7]=t("strong",null,"Tip:",-1)),e[8]||(e[8]=p(" You don't have any standalone workouts yet. ",-1)),q(n,{to:"/workouts",class:"underline"},{default:L(()=>[...e[5]||(e[5]=[p("Create some workouts",-1)])]),_:1}),e[9]||(e[9]=p(" first, then come back to assign them to your program. ",-1))])])):g("",!0),(a(!0),r(w,null,_(k.value,s=>(a(),r("div",{key:s.id,class:"space-y-3"},[t("h3",ye,d(s.name),1),t("div",he,[(a(),r(w,null,_(z,l=>t("div",{key:l.value,class:"aspect-square"},[E(s,l.value)?(a(),r("div",{key:0,class:"h-full card p-2 flex flex-col justify-between bg-summit-50 border-summit-200 cursor-pointer hover:shadow-md transition-shadow",onClick:m=>I(R).push(`/workouts/${E(s,l.value).id}/edit`)},[t("div",xe,d(N(l.value)),1),t("div",Ce,d(E(s,l.value).name),1),t("button",{onClick:A(m=>K(E(s,l.value).id),["stop"]),class:"text-xs text-red-600 hover:text-red-700"}," Remove ",8,We)],8,be)):(a(),r("button",{key:1,onClick:m=>G(s.id,l.value),class:"h-full w-full border-2 border-dashed border-gray-300 rounded-xl hover:border-summit-500 hover:bg-summit-50 transition-colors flex flex-col items-center justify-center gap-1 text-gray-400 hover:text-summit-700"},[t("div",$e,d(N(l.value)),1),e[10]||(e[10]=t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})],-1))],8,Ee))])),64))])]))),128)),e[11]||(e[11]=t("div",{class:"card p-4 bg-gray-50"},[t("p",{class:"text-sm text-gray-600"},[t("strong",null,"How it works:"),p(" Click any day to assign a workout. Workouts are copied from your library so you can customize them for each week. ")])],-1))])),q(re,{open:x.value,title:"Remove Workout?",message:"Remove this workout from the program? This cannot be undone.","confirm-text":"Remove",loading:M.value,onConfirm:Q,onCancel:e[1]||(e[1]=s=>x.value=!1)},null,8,["open","loading"]),q(ae,{message:F.value,type:V.value,visible:T.value,onClose:e[2]||(e[2]=s=>T.value=!1)},null,8,["message","type","visible"]),j.value?(a(),r("div",{key:2,class:"fixed inset-0 z-50 flex items-end sm:items-center justify-center bg-black bg-opacity-50",onClick:A(S,["self"])},[t("div",qe,[t("div",{class:"p-4 border-b border-feed-border flex items-center justify-between flex-shrink-0"},[e[13]||(e[13]=t("h2",{class:"font-semibold text-lg"},"Select Workout",-1)),t("button",{onClick:S,class:"w-8 h-8 rounded-full hover:bg-gray-100 flex items-center justify-center"},[...e[12]||(e[12]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),t("div",Re,[y.value.length===0?(a(),r("div",je,[e[15]||(e[15]=t("p",null,"No workouts available.",-1)),q(n,{to:"/workouts",class:"text-summit-700 underline text-sm"},{default:L(()=>[...e[14]||(e[14]=[p(" Create a workout first ",-1)])]),_:1})])):g("",!0),(a(!0),r(w,null,_(y.value,s=>(a(),r("button",{key:s.id,onClick:l=>J(s),class:"w-full text-left p-3 rounded-xl hover:bg-gray-50 border border-gray-200 hover:border-summit-300 transition-colors"},[t("h4",Te,d(s.name),1),s.description?(a(),r("p",De,d(s.description),1)):g("",!0),s.workout_type?(a(),r("div",Pe,d(s.workout_type),1)):g("",!0)],8,Me))),128))])])])):g("",!0)])}}});export{ze as default};
