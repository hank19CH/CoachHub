import{d as oe,u as re,m as ie,s as l,c as i,a as t,f as k,w as _,v as P,b as f,F as Q,n as R,A as ne,t as p,h as Y,g as D,C as ae,r as d,q as G,k as le,o as n}from"./index-CR_8Ibs2.js";import{_ as de}from"./ConfirmDialog.vue_vue_type_script_setup_true_lang-DVidb-Rq.js";import{_ as ue}from"./Toast.vue_vue_type_script_setup_true_lang-C6u_wdkL.js";const ce={class:"pb-20"},me={key:0,class:"p-4"},we={class:"relative"},pe={key:1,class:"p-6"},ve={class:"space-y-4"},fe={key:2,class:"p-6 text-center"},ge={key:3,class:"p-4 space-y-3"},ke={class:"flex items-start justify-between gap-3"},he=["onClick"],ye={class:"font-semibold text-gray-900 mb-1"},_e={key:0,class:"text-sm text-gray-600 mb-2 line-clamp-2"},xe={class:"flex flex-wrap gap-2 text-xs text-gray-500"},be={class:"inline-flex items-center gap-1"},Ce={key:0,class:"inline-flex items-center gap-1"},Me={key:1,class:"inline-flex items-center gap-1 capitalize"},Ve={class:"flex gap-1 flex-shrink-0"},Be=["onClick"],je=["onClick"],Pe=["onClick"],De={key:0,class:"text-center py-8 text-gray-500"},Ee={class:"bg-white w-full sm:max-w-lg sm:rounded-2xl rounded-t-2xl max-h-[90vh] flex flex-col animate-slide-up"},$e={class:"flex-1 overflow-y-auto p-4 space-y-4"},ze={key:0,class:"p-3 bg-red-50 border border-red-200 rounded-xl text-red-700 text-sm"},Ne={class:"p-4 border-t border-feed-border flex-shrink-0 space-y-2"},qe=["disabled"],Se={key:0,class:"flex items-center gap-2 justify-center"},He={key:1},Ue=oe({__name:"ProgramsView",setup(Le){const H=le(),c=re(),x=d([]),E=d(!0),h=d(""),$=d(!1),b=d(!1),C=d(null),z=d(!1),L=d(""),F=d("success"),N=d(!1);function M(o,e="success"){L.value=o,F.value=e,N.value=!0}const r=d({name:"",description:"",duration_weeks:4,difficulty:"",sport_id:null}),V=d(!1),g=d(""),T=G(()=>{if(!h.value)return x.value;const o=h.value.toLowerCase();return x.value.filter(e=>e.name.toLowerCase().includes(o)||e.description&&e.description.toLowerCase().includes(o))}),A=G(()=>x.value.length>0);ie(async()=>{await q()});async function q(){if(c.user)try{E.value=!0;const{data:o,error:e}=await l.from("programs").select("*, program_weeks(id, workouts:workouts(id))").eq("coach_id",c.user.id).order("created_at",{ascending:!1});if(e)throw e;x.value=(o||[]).map(s=>{const v=(s.program_weeks||[]).reduce((B,j)=>B+(j.workouts?.length||0),0),{program_weeks:m,...y}=s;return{...y,workout_count:v}})}catch(o){console.error("Error loading programs:",o?.message||o?.code||JSON.stringify(o))}finally{E.value=!1}}function U(){r.value={name:"",description:"",duration_weeks:4,difficulty:"",sport_id:null},g.value="",$.value=!0}function S(){$.value=!1,g.value=""}async function K(){if(!(!c.user||!r.value.name))try{V.value=!0,g.value="";const{data:o,error:e}=await l.from("programs").insert({coach_id:c.user.id,name:r.value.name,description:r.value.description||null,duration_weeks:r.value.duration_weeks,difficulty:r.value.difficulty||null,sport_id:r.value.sport_id,is_template:!0,is_published:!1}).select().single();if(e)throw e;H.push(`/programs/${o.id}/edit`)}catch(o){console.error("Error creating program:",o?.message||o?.code||JSON.stringify(o)),g.value=o?.message||(o instanceof Error?o.message:"Failed to create program")}finally{V.value=!1}}function I(o){H.push(`/programs/${o}/edit`)}function X(o){C.value=o,b.value=!0}async function Z(){const o=C.value;if(!(!c.user||!o)){z.value=!0;try{const{data:e}=await l.from("program_weeks").select("id").eq("program_id",o.id);if(e&&e.length>0){const u=e.map(m=>m.id),{data:v}=await l.from("workouts").select("id").in("program_week_id",u);if(v&&v.length>0){const m=v.map(y=>y.id);await l.from("exercises").delete().in("workout_id",m),await l.from("workouts").delete().in("id",m).eq("coach_id",c.user.id)}await l.from("program_weeks").delete().in("id",u)}const{error:s}=await l.from("programs").delete().eq("id",o.id).eq("coach_id",c.user.id);if(s)throw s;b.value=!1,C.value=null,await q(),M("Program deleted")}catch(e){console.error("Error deleting program:",e),M("Failed to delete program","error")}finally{z.value=!1}}}async function ee(o){if(c.user)try{const{data:e,error:s}=await l.from("programs").insert({coach_id:c.user.id,name:`${o.name} (Copy)`,description:o.description,duration_weeks:o.duration_weeks,difficulty:o.difficulty,sport_id:o.sport_id,is_template:o.is_template,is_published:!1}).select().single();if(s)throw s;const{data:u,error:v}=await l.from("program_weeks").select("*").eq("program_id",o.id).order("week_number");if(v)throw v;if(u&&u.length>0)for(const m of u){const{data:y,error:B}=await l.from("program_weeks").insert({program_id:e.id,week_number:m.week_number,name:m.name,notes:m.notes}).select().single();if(B)throw B;const{data:j,error:W}=await l.from("workouts").select("*, exercises(*)").eq("program_week_id",m.id);if(W)throw W;if(j)for(const w of j){const{data:te,error:J}=await l.from("workouts").insert({coach_id:c.user.id,program_week_id:y.id,name:w.name,description:w.description,day_of_week:w.day_of_week,estimated_duration_min:w.estimated_duration_min,workout_type:w.workout_type,is_template:w.is_template}).select().single();if(J)throw J;if(w.exercises&&w.exercises.length>0){const se=w.exercises.map(a=>({workout_id:te.id,name:a.name,description:a.description,order_index:a.order_index,sets:a.sets,reps:a.reps,weight_kg:a.weight_kg,duration_seconds:a.duration_seconds,distance_meters:a.distance_meters,rpe:a.rpe,intensity_percent:a.intensity_percent,target_time_seconds:a.target_time_seconds,rest_seconds:a.rest_seconds,notes:a.notes,video_url:a.video_url})),{error:O}=await l.from("exercises").insert(se);if(O)throw O}}}await q(),M(`"${e.name}" duplicated successfully`)}catch(e){console.error("Error duplicating program:",e),M("Failed to duplicate program","error")}}return(o,e)=>(n(),i("div",ce,[t("div",{class:"sticky top-0 z-10 bg-white border-b border-feed-border px-4 py-3"},[t("div",{class:"flex items-center justify-between"},[e[8]||(e[8]=t("h1",{class:"font-display text-xl font-bold text-gray-900"},"Programs",-1)),t("button",{onClick:U,class:"btn-primary px-4 py-2 text-sm"},[...e[7]||(e[7]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-4 h-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4v16m8-8H4"})],-1),k(" New Program ",-1)])])])]),A.value?(n(),i("div",me,[t("div",we,[_(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>h.value=s),type:"text",placeholder:"Search programs...",class:"input pl-10"},null,512),[[P,h.value]]),e[9]||(e[9]=t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-5 h-5 text-gray-400 absolute left-3 top-1/2 -translate-y-1/2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1))])])):f("",!0),E.value?(n(),i("div",pe,[t("div",ve,[(n(),i(Q,null,R(3,s=>t("div",{key:s,class:"animate-pulse"},[...e[10]||(e[10]=[t("div",{class:"p-4 bg-gray-50 rounded-xl"},[t("div",{class:"h-5 bg-gray-200 rounded w-3/4 mb-2"}),t("div",{class:"h-4 bg-gray-200 rounded w-1/2"})],-1)])])),64))])])):A.value?(n(),i("div",ge,[(n(!0),i(Q,null,R(T.value,s=>(n(),i("div",{key:s.id,class:"card p-4 hover:shadow-md transition-shadow"},[t("div",ke,[t("div",{onClick:u=>I(s.id),class:"flex-1 min-w-0 cursor-pointer"},[t("h3",ye,p(s.name),1),s.description?(n(),i("p",_e,p(s.description),1)):f("",!0),t("div",xe,[t("span",be,[e[13]||(e[13]=t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)),k(" "+p(s.duration_weeks)+" week"+p(s.duration_weeks!==1?"s":""),1)]),s.workout_count?(n(),i("span",Ce,[e[14]||(e[14]=t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})],-1)),k(" "+p(s.workout_count)+" workout"+p(s.workout_count!==1?"s":""),1)])):f("",!0),s.difficulty?(n(),i("span",Me,[e[15]||(e[15]=t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M13 10V3L4 14h7v7l9-11h-7z"})],-1)),k(" "+p(s.difficulty),1)])):f("",!0)])],8,he),t("div",Ve,[t("button",{onClick:D(u=>I(s.id),["stop"]),class:"p-2 hover:bg-gray-100 rounded-lg transition-colors",title:"Edit program"},[...e[16]||(e[16]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-5 h-5 text-gray-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)])],8,Be),t("button",{onClick:D(u=>ee(s),["stop"]),class:"p-2 hover:bg-gray-100 rounded-lg transition-colors",title:"Duplicate program"},[...e[17]||(e[17]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-5 h-5 text-gray-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})],-1)])],8,je),t("button",{onClick:D(u=>X(s),["stop"]),class:"p-2 hover:bg-red-50 rounded-lg transition-colors",title:"Delete program"},[...e[18]||(e[18]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-5 h-5 text-gray-400 hover:text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,Pe)])])]))),128)),T.value.length===0?(n(),i("div",De,[t("p",null,'No programs found matching "'+p(h.value)+'"',1)])):f("",!0)])):(n(),i("div",fe,[t("div",{class:"max-w-sm mx-auto"},[e[12]||(e[12]=ne('<div class="w-20 h-20 mx-auto mb-4 bg-summit-100 rounded-full flex items-center justify-center"><svg xmlns="http://www.w3.org/2000/svg" class="w-10 h-10 text-summit-700" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg></div><h2 class="font-semibold text-lg text-gray-900 mb-2">No programs yet</h2><p class="text-gray-600 mb-6"> Create your first training program with multiple weeks and structured workouts </p>',3)),t("button",{onClick:U,class:"btn-primary w-full"},[...e[11]||(e[11]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-5 h-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4v16m8-8H4"})],-1),k(" Create Your First Program ",-1)])])])])),Y(de,{open:b.value,title:"Delete Program?",message:`Delete "${C.value?.name}"? This will also delete all weeks and workouts. This cannot be undone.`,"confirm-text":"Delete",loading:z.value,onConfirm:Z,onCancel:e[1]||(e[1]=s=>b.value=!1)},null,8,["open","message","loading"]),Y(ue,{message:L.value,type:F.value,visible:N.value,onClose:e[2]||(e[2]=s=>N.value=!1)},null,8,["message","type","visible"]),$.value?(n(),i("div",{key:4,class:"fixed inset-0 z-50 flex items-end sm:items-center justify-center bg-black bg-opacity-50",onClick:D(S,["self"])},[t("div",Ee,[t("div",{class:"p-4 border-b border-feed-border flex items-center justify-between flex-shrink-0"},[e[20]||(e[20]=t("h2",{class:"font-semibold text-lg"},"Create Program",-1)),t("button",{onClick:S,class:"w-8 h-8 rounded-full hover:bg-gray-100 flex items-center justify-center"},[...e[19]||(e[19]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),t("div",$e,[g.value?(n(),i("div",ze,p(g.value),1)):f("",!0),t("div",null,[e[21]||(e[21]=t("label",{class:"label"},"Program Name *",-1)),_(t("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>r.value.name=s),type:"text",placeholder:"e.g., 4-Week Speed Development Block",class:"input",required:""},null,512),[[P,r.value.name]])]),t("div",null,[e[22]||(e[22]=t("label",{class:"label"},"Description",-1)),_(t("textarea",{"onUpdate:modelValue":e[4]||(e[4]=s=>r.value.description=s),rows:"3",placeholder:"Brief overview of the program...",class:"input resize-none"},null,512),[[P,r.value.description]])]),t("div",null,[e[23]||(e[23]=t("label",{class:"label"},"Duration (weeks) *",-1)),_(t("input",{"onUpdate:modelValue":e[5]||(e[5]=s=>r.value.duration_weeks=s),type:"number",min:"1",max:"52",class:"input",required:""},null,512),[[P,r.value.duration_weeks,void 0,{number:!0}]])]),t("div",null,[e[25]||(e[25]=t("label",{class:"label"},"Difficulty Level",-1)),_(t("select",{"onUpdate:modelValue":e[6]||(e[6]=s=>r.value.difficulty=s),class:"input"},[...e[24]||(e[24]=[t("option",{value:""},"Select level...",-1),t("option",{value:"beginner"},"Beginner",-1),t("option",{value:"intermediate"},"Intermediate",-1),t("option",{value:"advanced"},"Advanced",-1)])],512),[[ae,r.value.difficulty]])]),e[26]||(e[26]=t("div",{class:"p-3 bg-summit-50 border border-summit-200 rounded-xl text-sm text-summit-800"},[t("p",{class:"font-medium mb-1"},"ðŸ’¡ Next Step"),t("p",null,"After creating the program, you'll build out each week and assign workouts to specific days.")],-1))]),t("div",Ne,[t("button",{onClick:K,disabled:!r.value.name||V.value,class:"btn-primary w-full"},[V.value?(n(),i("span",Se,[...e[27]||(e[27]=[t("svg",{class:"animate-spin h-4 w-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),k(" Creating... ",-1)])])):(n(),i("span",He,"Create & Build Program"))],8,qe),t("button",{onClick:S,class:"btn-secondary w-full"}," Cancel ")])])])):f("",!0)]))}});export{Ue as default};
