import{s}from"./index-CR_8Ibs2.js";async function b(a){const{data:e,error:t}=await s.from("groups").select(`
      *,
      team:teams(id, name),
      sport:sports(id, name, icon)
    `).eq("coach_id",a).order("created_at",{ascending:!1});if(t)return console.error("Error fetching groups:",t),[];const o=(e||[]).map(r=>({...r,team:Array.isArray(r.team)?r.team[0]??null:r.team??null,sport:Array.isArray(r.sport)?r.sport[0]??null:r.sport??null}));if(o.length>0){const r=o.map(i=>i.id),{data:c}=await s.from("group_members").select("group_id").in("group_id",r),u=new Map;for(const i of c||[])u.set(i.group_id,(u.get(i.group_id)||0)+1);for(const i of o)i.member_count=u.get(i.id)||0}return o}async function k(a){const{data:e,error:t}=await s.from("groups").select(`
      *,
      team:teams(id, name),
      sport:sports(id, name, icon)
    `).eq("id",a).single();return t?(console.error("Error fetching group:",t),null):{...e,team:Array.isArray(e.team)?e.team[0]??null:e.team??null,sport:Array.isArray(e.sport)?e.sport[0]??null:e.sport??null}}async function A(a){const{data:e,error:t}=await s.from("groups").insert(a).select().single();return t?(console.error("Error creating group:",t),null):e}async function E(a,e){const{data:t,error:o}=await s.from("groups").update({...e,updated_at:new Date().toISOString()}).eq("id",a).select().single();return o?(console.error("Error updating group:",o),null):t}async function q(a){const{error:e}=await s.from("groups").delete().eq("id",a);return e?(console.error("Error deleting group:",e),!1):!0}async function G(a){const{data:e,error:t}=await s.from("group_members").select("*, athlete:profiles!athlete_id(id, username, display_name, avatar_url, user_type)").eq("group_id",a).order("joined_at",{ascending:!0});return t?(console.error("Error fetching group members:",t),[]):(e||[]).map(o=>({...o,athlete:Array.isArray(o.athlete)?o.athlete[0]:o.athlete}))}async function C(a,e){const t=e.map(c=>({group_id:a,athlete_id:c})),{data:o,error:r}=await s.from("group_members").upsert(t,{onConflict:"group_id,athlete_id",ignoreDuplicates:!0}).select();return r?(console.error("Error adding group members:",r),null):o}async function D(a,e){const{error:t}=await s.from("group_members").delete().eq("group_id",a).eq("athlete_id",e);return t?(console.error("Error removing group member:",t),!1):!0}async function M(a){const{data:e,error:t}=await s.from("teams").select("*, sport:sports(id, name, icon)").eq("coach_id",a).order("created_at",{ascending:!1});return t?(console.error("Error fetching teams:",t),[]):(e||[]).map(o=>({...o,sport:Array.isArray(o.sport)?o.sport[0]??null:o.sport??null}))}async function S(a,e,t,o){const{data:r}=await s.from("program_weeks").select("id, week_number").eq("program_id",a).order("week_number");if(!r||r.length===0)return{success:!1,error:"No weeks found in program"};const c=r.map(n=>n.id),{data:u}=await s.from("workouts").select("id, program_week_id, day_of_week").in("program_week_id",c).order("day_of_week");if(!u||u.length===0)return{success:!1,error:"No workouts found in program"};const{data:i}=await s.from("group_members").select("athlete_id").eq("group_id",e);if(!i||i.length===0)return{success:!1,error:"No members in this group"};const g=new Map;for(const n of r)g.set(n.id,n.week_number);const _=new Date(o),p=[];for(const n of u){const l=((g.get(n.program_week_id)||1)-1)*7+(n.day_of_week||0),d=new Date(_);d.setDate(d.getDate()+l);const h=d.toISOString().split("T")[0];for(const w of i)p.push({workout_id:n.id,athlete_id:w.athlete_id,coach_id:t,assigned_date:h,status:"pending"})}const m=100;for(let n=0;n<p.length;n+=m){const f=p.slice(n,n+m),{error:l}=await s.from("workout_assignments").insert(f);if(l)return console.error("Error inserting assignments batch:",l),{success:!1,error:`Failed at batch ${n/m+1}: ${l.message}`}}return{success:!0,assignmentCount:p.length,workoutCount:u.length,memberCount:i.length}}async function I(a){const{data:e,error:t}=await s.from("group_members").select(`
      group:groups(
        id, name, description, created_at,
        coach:profiles!coach_id(id, username, display_name, avatar_url),
        team:teams(id, name),
        sport:sports(id, name, icon)
      )
    `).eq("athlete_id",a);return t?(console.error("Error fetching athlete groups:",t),[]):(e||[]).map(o=>{const r=Array.isArray(o.group)?o.group[0]:o.group;return r&&(r.coach=Array.isArray(r.coach)?r.coach[0]??null:r.coach??null,r.team=Array.isArray(r.team)?r.team[0]??null:r.team??null,r.sport=Array.isArray(r.sport)?r.sport[0]??null:r.sport??null),r}).filter(Boolean)}async function N(){const{data:a,error:e}=await s.from("sports").select("*").eq("is_approved",!0).order("name");return e?(console.error("Error fetching sports:",e),[]):a||[]}export{M as a,N as b,A as c,q as d,k as e,G as f,b as g,C as h,S as i,I as j,D as r,E as u};
