import{s as l,d as E,c as n,a as w,F as p,n as v,E as S,b as f,t as y,r as D,q as b,o as s,z as T,A as j,p as B}from"./index-CR_8Ibs2.js";import{_ as M}from"./WorkoutCard.vue_vue_type_script_setup_true_lang-DRkSk4fJ.js";async function R(t,o=50){const{data:e,error:r}=await l.from("comments").select("*, author:profiles!author_id(id, username, display_name, avatar_url)").eq("post_id",t).is("parent_id",null).order("created_at",{ascending:!0}).limit(o);return r?(console.error("Error fetching comments:",r),[]):(e||[]).map(a=>{const c=Array.isArray(a.author)?a.author[0]:a.author;return{...a,author:c}})}async function W(t,o,e,r){const{data:a,error:c}=await l.from("comments").insert({post_id:t,author_id:o,content:e,parent_id:null}).select("*, author:profiles!author_id(id, username, display_name, avatar_url)").single();if(c)return console.error("Error adding comment:",c),null;const{data:m}=await l.from("posts").select("comments_count").eq("id",t).single();if(m&&await l.from("posts").update({comments_count:(m.comments_count||0)+1}).eq("id",t),a){const h={...a};return h.author=Array.isArray(a.author)?a.author[0]:a.author,h}return a}async function G(t,o){const{error:e}=await l.from("comments").delete().eq("id",t);if(e)return console.error("Error deleting comment:",e),!1;const{data:r}=await l.from("posts").select("comments_count").eq("id",o).single();return r&&await l.from("posts").update({comments_count:Math.max(0,(r.comments_count||1)-1)}).eq("id",o),!0}async function H(t,o){const{data:e}=await l.from("follows").select("id, status").eq("follower_id",t).eq("following_id",o).maybeSingle();return e?{isFollowing:!0,status:e.status}:{isFollowing:!1,status:null}}async function J(t,o,e){const r=e?"pending":"active",{data:a,error:c}=await l.from("follows").insert({follower_id:t,following_id:o,status:r}).select().single();return c?(console.error("Error following user:",c),null):a}async function K(t,o){const{error:e}=await l.from("follows").delete().eq("follower_id",t).eq("following_id",o);return e?(console.error("Error unfollowing user:",e),!1):!0}async function O(t,o){const{error:e}=await l.from("post_media").delete().eq("post_id",t);e&&console.error("Error deleting post media:",e);const{error:r}=await l.from("posts").delete().eq("id",t).eq("author_id",o);return r?(console.error("Error deleting post:",r),!1):!0}async function Q(t){const{data:o,error:e}=await l.from("posts").select(`
      *,
      author:profiles!author_id(*),
      media:post_media(*),
      workout_completion:workout_completions!posts_workout_completion_id_fkey(
        id, duration_minutes, overall_rpe, has_pb, completed_at,
        shared_exercise_ids, share_settings,
        assignment:workout_assignments!workout_completions_assignment_id_fkey(
          workout:workouts!workout_assignments_workout_id_fkey(id, name, description)
        )
      )
    `).eq("id",t).single();return e?(console.error("Error fetching post:",e),null):o}const z=["src","alt"],A=["src","poster"],F={key:2,class:"w-full h-full"},X={key:1,class:"w-full h-full bg-gradient-to-br from-violet-700 via-purple-700 to-purple-900 flex items-center justify-center"},N={key:1,class:"absolute bottom-3 left-1/2 -translate-x-1/2 flex gap-1.5"},P=["onClick"],V={key:2,class:"absolute top-3 right-3 px-2.5 py-1 rounded-full bg-black/50 text-white text-xs font-medium"},Y=E({__name:"MediaCarousel",props:{media:{},postType:{},workoutCardData:{}},setup(t){const o=t,e=D(0),r=b(()=>[...o.media].sort((u,i)=>u.media_type==="workout_card"?1:i.media_type==="workout_card"?-1:u.display_order-i.display_order)),a=b(()=>r.value.length>1);function c(u){e.value=u}function m(){e.value<r.value.length-1&&e.value++}function h(){e.value>0&&e.value--}let g=0,k=0;function x(u){g=u.changedTouches[0]?.screenX??0}function C(u){k=u.changedTouches[0]?.screenX??0,q()}function q(){const i=g-k;Math.abs(i)>50&&(i>0?m():h())}return(u,i)=>(s(),n("div",{class:"relative bg-gray-100 aspect-square overflow-hidden",onTouchstart:x,onTouchend:C},[w("div",{class:"flex transition-transform duration-300 ease-out h-full",style:S({transform:`translateX(-${e.value*100}%)`})},[(s(!0),n(p,null,v(r.value,d=>(s(),n("div",{key:d.id,class:"w-full h-full flex-shrink-0 relative"},[d.media_type==="image"?(s(),n("img",{key:0,src:d.url,alt:d.alt_text||"Post image",class:"w-full h-full object-cover",loading:"lazy"},null,8,z)):d.media_type==="video"?(s(),n("video",{key:1,src:d.url,poster:d.thumbnail_url||void 0,class:"w-full h-full object-cover",controls:"",playsinline:"",preload:"metadata"},null,8,A)):d.media_type==="workout_card"?(s(),n("div",F,[t.workoutCardData?(s(),T(M,{key:0,"workout-name":t.workoutCardData.workoutName,duration:t.workoutCardData.duration,"completed-at":t.workoutCardData.completedAt,exercises:t.workoutCardData.exercises,"share-settings":t.workoutCardData.shareSettings,"overall-rpe":t.workoutCardData.overallRpe,"pb-count":t.workoutCardData.pbCount},null,8,["workout-name","duration","completed-at","exercises","share-settings","overall-rpe","pb-count"])):(s(),n("div",X,[...i[0]||(i[0]=[j('<div class="text-center text-white p-6"><div class="w-16 h-16 mx-auto mb-4 rounded-full bg-white/20 flex items-center justify-center"><svg class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg></div><p class="font-bold text-lg">Workout Complete</p></div>',1)])]))])):f("",!0)]))),128))],4),a.value?(s(),n(p,{key:0},[e.value>0?(s(),n("button",{key:0,onClick:h,class:"absolute left-2 top-1/2 -translate-y-1/2 w-8 h-8 rounded-full bg-black/50 text-white flex items-center justify-center hover:bg-black/70 transition-colors hidden sm:flex"},[...i[1]||(i[1]=[w("svg",{class:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[w("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 19l-7-7 7-7"})],-1)])])):f("",!0),e.value<r.value.length-1?(s(),n("button",{key:1,onClick:m,class:"absolute right-2 top-1/2 -translate-y-1/2 w-8 h-8 rounded-full bg-black/50 text-white flex items-center justify-center hover:bg-black/70 transition-colors hidden sm:flex"},[...i[2]||(i[2]=[w("svg",{class:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[w("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9 5l7 7-7 7"})],-1)])])):f("",!0)],64)):f("",!0),a.value?(s(),n("div",N,[(s(!0),n(p,null,v(r.value,(d,_)=>(s(),n("button",{key:d.id,onClick:$=>c(_),class:B(["w-1.5 h-1.5 rounded-full transition-all",[_===e.value?"bg-white w-3":"bg-white/50 hover:bg-white/75"]])},null,10,P))),128))])):f("",!0),a.value?(s(),n("div",V,y(e.value+1)+"/"+y(r.value.length),1)):f("",!0)],32))}});export{Y as _,Q as a,R as b,W as c,O as d,G as e,J as f,H as g,K as u};
