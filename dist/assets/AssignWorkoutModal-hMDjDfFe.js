import{s as m,d as j,u as L,r as v,L as $,c as g,a as t,g as z,f as y,w as _,E as S,F as I,n as E,b as x,t as f,v as C,q as A,o as w,_ as G}from"./index-DoIKaNgo.js";import{b as H}from"./athletes-Bm142xSv.js";import{a as J}from"./assignments-DfYOGptN.js";const W={async getCoachWorkouts(i){const{data:l,error:e}=await m.from("workouts").select("*").eq("coach_id",i).order("updated_at",{ascending:!1});if(e)throw console.error("Error fetching coach workouts:",e),new Error("Failed to fetch workouts");return l||[]},async getWorkoutById(i,l){let e=m.from("workouts").select(`
        *,
        exercises (
          id,
          name,
          description,
          order_index,
          sets,
          reps,
          weight_kg,
          duration_seconds,
          distance_meters,
          rpe,
          intensity_percent,
          target_time_seconds,
          rest_seconds,
          notes,
          video_url
        )
      `).eq("id",i);l&&(e=e.eq("coach_id",l));const{data:a,error:d}=await e.single();if(d)throw console.error("Error fetching workout:",d),new Error("Failed to fetch workout");return a?.exercises&&a.exercises.sort((p,c)=>p.order_index-c.order_index),a},async getTemplateWorkouts(i){const{data:l,error:e}=await m.from("workouts").select("*").eq("coach_id",i).eq("is_template",!0).order("name",{ascending:!0});if(e)throw console.error("Error fetching template workouts:",e),new Error("Failed to fetch template workouts");return l||[]},async createWorkout(i){const{data:l,error:e}=await m.from("workouts").insert(i).select().single();if(e)throw console.error("Error creating workout:",e),new Error("Failed to create workout");return l},async updateWorkout(i,l,e){let a=m.from("workouts").update({...l,updated_at:new Date().toISOString()}).eq("id",i);e&&(a=a.eq("coach_id",e));const{data:d,error:p}=await a.select().single();if(p)throw console.error("Error updating workout:",p),new Error("Failed to update workout");return d},async deleteWorkout(i,l){const{error:e}=await m.from("exercises").delete().eq("workout_id",i);if(e)throw console.error("Error deleting workout exercises:",e),new Error("Failed to delete workout exercises");let a=m.from("workouts").delete().eq("id",i);l&&(a=a.eq("coach_id",l));const{error:d}=await a;if(d)throw console.error("Error deleting workout:",d),new Error("Failed to delete workout")},async duplicateWorkout(i,l){const e=await W.getWorkoutById(i,l),{data:a,error:d}=await m.from("workouts").insert({coach_id:l,name:`${e.name} (Copy)`,description:e.description,workout_type:e.workout_type,estimated_duration_min:e.estimated_duration_min,is_template:e.is_template}).select().single();if(d||!a)throw console.error("Error duplicating workout:",d),new Error("Failed to duplicate workout");if(e.exercises.length>0){const p=e.exercises.map(u=>({workout_id:a.id,name:u.name,description:u.description,order_index:u.order_index,sets:u.sets,reps:u.reps,weight_kg:u.weight_kg,duration_seconds:u.duration_seconds,distance_meters:u.distance_meters,rpe:u.rpe,intensity_percent:u.intensity_percent,target_time_seconds:u.target_time_seconds,rest_seconds:u.rest_seconds,notes:u.notes,video_url:u.video_url})),{error:c}=await m.from("exercises").insert(p);c&&console.error("Error duplicating exercises:",c)}return W.getWorkoutById(a.id)},async searchWorkouts(i,l){const{data:e,error:a}=await m.from("workouts").select("*").eq("coach_id",i).ilike("name",`%${l}%`).order("updated_at",{ascending:!1});if(a)throw console.error("Error searching workouts:",a),new Error("Failed to search workouts");return e||[]},async getWorkoutsByType(i,l){const{data:e,error:a}=await m.from("workouts").select("*").eq("coach_id",i).eq("workout_type",l).order("updated_at",{ascending:!1});if(a)throw console.error("Error fetching workouts by type:",a),new Error("Failed to fetch workouts");return e||[]}},K={key:0,class:"fixed inset-0 z-50 overflow-y-auto"},P={class:"flex min-h-full items-end sm:items-center justify-center p-4"},Q={class:"relative bg-white rounded-2xl shadow-xl max-w-lg w-full p-6 transform transition-all max-h-[90vh] overflow-y-auto"},R=["value"],X={key:0},Y={key:0,class:"flex flex-wrap gap-2 mb-3"},Z=["onClick"],ee=["value"],te={class:"mt-1 text-sm text-gray-500"},oe=["min"],re={class:"mt-1 text-sm text-gray-500"},se={key:0,class:"p-4 bg-red-50 border border-red-200 rounded-lg"},ae={class:"text-sm text-red-600"},ne={class:"flex gap-3 pt-4 pb-2"},le=["disabled"],ie=j({__name:"AssignWorkoutModal",props:{isOpen:{type:Boolean},preselectedWorkoutId:{default:null},preselectedAthleteId:{default:null}},emits:["close","assigned"],setup(i,{emit:l}){const e=i,a=l,d=L(),p=v(!1),c=v(""),u=v([]),b=v([]),k=v(""),r=v({workoutId:e.preselectedWorkoutId||"",athleteIds:e.preselectedAthleteId?[e.preselectedAthleteId]:[],assignedDate:D(),notes:""}),F=A(()=>new Date().toISOString().split("T")[0]),B=A(()=>b.value.filter(s=>!r.value.athleteIds.includes(s.id))),q=A(()=>r.value.workoutId&&r.value.athleteIds.length>0&&r.value.assignedDate&&r.value.notes.length<=500);function D(){const s=new Date;return s.setDate(s.getDate()+1),s.toISOString().split("T")[0]}function M(s){const o=b.value.find(n=>n.id===s);return o?o.display_name:"Unknown"}function T(){k.value&&!r.value.athleteIds.includes(k.value)&&r.value.athleteIds.push(k.value),k.value=""}function V(s){r.value.athleteIds=r.value.athleteIds.filter(o=>o!==s)}async function O(){if(d.user?.id)try{const s=await W.getCoachWorkouts(d.user.id);u.value=s}catch(s){console.error("Error loading workouts:",s),c.value="Failed to load workouts"}}async function N(){if(d.user?.id)try{const s=await H.getCoachAthletes(d.user.id);b.value=s}catch(s){console.error("Error loading athletes:",s),c.value="Failed to load athletes"}}async function U(){if(!(!q.value||!d.user?.id)){p.value=!0,c.value="";try{const s=await J.createBatchAssignments({workoutId:r.value.workoutId,athleteIds:r.value.athleteIds,coachId:d.user.id,assignedDate:r.value.assignedDate,notes:r.value.notes||void 0});a("assigned",s.map(o=>o.id)),h()}catch(s){console.error("Error assigning workout:",s),c.value=s.message||"Failed to assign workout"}finally{p.value=!1}}}function h(){r.value={workoutId:"",athleteIds:[],assignedDate:D(),notes:""},c.value="",k.value="",a("close")}return $(()=>e.isOpen,s=>{s&&(O(),N(),e.preselectedWorkoutId&&(r.value.workoutId=e.preselectedWorkoutId),e.preselectedAthleteId&&!r.value.athleteIds.includes(e.preselectedAthleteId)&&(r.value.athleteIds=[e.preselectedAthleteId]))}),(s,o)=>i.isOpen?(w(),g("div",K,[t("div",{class:"fixed inset-0 bg-black bg-opacity-50 transition-opacity",onClick:h}),t("div",P,[t("div",Q,[t("div",{class:"flex items-center justify-between mb-6"},[o[5]||(o[5]=t("h2",{class:"text-2xl font-bold text-gray-900"},"Assign Workout",-1)),t("button",{onClick:h,class:"text-gray-400 hover:text-gray-600 transition-colors"},[...o[4]||(o[4]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),t("form",{onSubmit:z(U,["prevent"]),class:"space-y-6"},[t("div",null,[o[7]||(o[7]=t("label",{class:"block text-sm font-semibold text-gray-700 mb-2"},[y(" Select Workout "),t("span",{class:"text-red-500"},"*")],-1)),_(t("select",{"onUpdate:modelValue":o[0]||(o[0]=n=>r.value.workoutId=n),required:"",class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-summit-500 focus:border-transparent transition-all"},[o[6]||(o[6]=t("option",{value:""},"Choose a workout...",-1)),(w(!0),g(I,null,E(u.value,n=>(w(),g("option",{key:n.id,value:n.id},[y(f(n.name)+" ",1),n.workout_type?(w(),g("span",X," - "+f(n.workout_type),1)):x("",!0)],8,R))),128))],512),[[S,r.value.workoutId]]),o[8]||(o[8]=t("p",{class:"mt-1 text-sm text-gray-500"},"Select which workout to assign",-1))]),t("div",null,[o[11]||(o[11]=t("label",{class:"block text-sm font-semibold text-gray-700 mb-2"},[y(" Assign To "),t("span",{class:"text-red-500"},"*")],-1)),r.value.athleteIds.length>0?(w(),g("div",Y,[(w(!0),g(I,null,E(r.value.athleteIds,n=>(w(),g("div",{key:n,class:"inline-flex items-center gap-2 px-3 py-1 bg-summit-100 text-summit-700 rounded-full text-sm"},[t("span",null,f(M(n)),1),t("button",{type:"button",onClick:de=>V(n),class:"hover:text-summit-900"},[...o[9]||(o[9]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,Z)]))),128))])):x("",!0),_(t("select",{"onUpdate:modelValue":o[1]||(o[1]=n=>k.value=n),onChange:T,class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-summit-500 focus:border-transparent transition-all"},[o[10]||(o[10]=t("option",{value:""},"+ Add athlete...",-1)),(w(!0),g(I,null,E(B.value,n=>(w(),g("option",{key:n.id,value:n.id},f(n.display_name)+" (@"+f(n.username)+") ",9,ee))),128))],544),[[S,k.value]]),t("p",te,f(r.value.athleteIds.length===0?"Select at least one athlete":`${r.value.athleteIds.length} athlete(s) selected`),1)]),t("div",null,[o[12]||(o[12]=t("label",{class:"block text-sm font-semibold text-gray-700 mb-2"},[y(" Assigned Date "),t("span",{class:"text-red-500"},"*")],-1)),_(t("input",{type:"date","onUpdate:modelValue":o[2]||(o[2]=n=>r.value.assignedDate=n),required:"",min:F.value,class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-summit-500 focus:border-transparent transition-all"},null,8,oe),[[C,r.value.assignedDate]]),o[13]||(o[13]=t("p",{class:"mt-1 text-sm text-gray-500"},"When should this workout be completed?",-1))]),t("div",null,[o[14]||(o[14]=t("label",{class:"block text-sm font-semibold text-gray-700 mb-2"}," Notes (Optional) ",-1)),_(t("textarea",{"onUpdate:modelValue":o[3]||(o[3]=n=>r.value.notes=n),rows:"3",placeholder:"Add any specific instructions for this assignment...",class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-summit-500 focus:border-transparent transition-all resize-none"},null,512),[[C,r.value.notes]]),t("p",re,f(r.value.notes.length)+"/500 characters ",1)]),c.value?(w(),g("div",se,[t("p",ae,f(c.value),1)])):x("",!0),t("div",ne,[t("button",{type:"button",onClick:h,class:"btn-secondary flex-1"}," Cancel "),t("button",{type:"submit",disabled:p.value||!q.value,class:"btn-primary flex-1"},f(p.value?"Assigning...":"Assign Workout"),9,le)])],32)])])])):x("",!0)}}),me=G(ie,[["__scopeId","data-v-6a7af652"]]);export{me as A};
