import{d as A,u as H,m as O,s as u,c as r,a as t,B as S,t as d,F as w,n as _,b as p,f,h as $,i as F,g as z,k as Y,r as m,q as G,j as J,o as a,l as K}from"./index-B256TZ31.js";const Q={class:"pb-20"},U={class:"sticky top-0 z-10 bg-white border-b border-feed-border px-4 py-3"},X={class:"flex items-center gap-3"},Z={class:"flex-1 min-w-0"},ee={class:"font-display text-lg font-bold text-gray-900 truncate"},te={class:"text-sm text-gray-500"},oe={key:0,class:"p-6"},se={class:"animate-pulse space-y-4"},re={class:"grid grid-cols-7 gap-2"},ae={key:1,class:"p-4 space-y-6"},ne={key:0,class:"card p-4"},ie={class:"text-sm text-gray-700"},le={key:1,class:"card p-4 bg-blue-50 border border-blue-200"},de={class:"text-sm text-blue-800"},ue={class:"font-semibold text-gray-900"},ce={class:"grid grid-cols-7 gap-2"},me=["onClick"],ve={class:"text-xs text-summit-700 font-medium"},ge={class:"text-xs font-semibold text-gray-900 line-clamp-2 leading-tight"},pe=["onClick"],fe=["onClick"],ke={class:"text-xs font-medium"},we={class:"bg-white w-full sm:max-w-lg sm:rounded-2xl rounded-t-2xl max-h-[70vh] flex flex-col animate-slide-up"},_e={class:"flex-1 overflow-y-auto p-4 space-y-2"},he={key:0,class:"text-center py-8 text-gray-500"},ye=["onClick"],be={class:"font-semibold text-gray-900 mb-1"},xe={key:0,class:"text-sm text-gray-600 line-clamp-2"},Ce={key:1,class:"text-xs text-gray-500 mt-1"},qe=A({__name:"ProgramEditorView",setup(We){const N=K(),W=Y(),v=H(),g=m(null),k=m([]),h=m([]),D=m(!0),E=m(!1),y=m(null),b=m(null),q=G(()=>N.params.id),M=[{value:1,label:"Monday"},{value:2,label:"Tuesday"},{value:3,label:"Wednesday"},{value:4,label:"Thursday"},{value:5,label:"Friday"},{value:6,label:"Saturday"},{value:7,label:"Sunday"}];O(async()=>{await j(),await R()});async function j(){if(v.user)try{const{data:s,error:e}=await u.from("programs").select("*").eq("id",q.value).eq("coach_id",v.user.id).single();if(e)throw e;g.value=s;const{data:n,error:o}=await u.from("program_weeks").select("*").eq("program_id",q.value).order("week_number");if(o)throw o;if(n&&n.length>0){const i=await Promise.all(n.map(async c=>{const{data:C}=await u.from("workouts").select("*").eq("program_week_id",c.id).order("day_of_week");return{...c,workouts:C||[]}}));k.value=i}else await V()}catch(s){console.error("Error loading program:",s),W.push("/programs")}finally{D.value=!1}}async function V(){if(g.value)try{const s=[];for(let o=1;o<=g.value.duration_weeks;o++)s.push({program_id:q.value,week_number:o,name:`Week ${o}`});const{data:e,error:n}=await u.from("program_weeks").insert(s).select();if(n)throw n;k.value=(e||[]).map(o=>({...o,workouts:[]}))}catch(s){console.error("Error initializing weeks:",s)}}async function R(){if(v.user)try{const{data:s,error:e}=await u.from("workouts").select("*").eq("coach_id",v.user.id).is("program_week_id",null).order("name");if(e)throw e;h.value=s||[]}catch(s){console.error("Error loading workouts:",s)}}function T(s,e){y.value=s,b.value=e,E.value=!0}function B(){E.value=!1,y.value=null,b.value=null}async function I(s){if(!(!y.value||b.value===null))try{const{data:e,error:n}=await u.from("workouts").insert({coach_id:v.user.id,program_week_id:y.value,name:s.name,description:s.description,day_of_week:b.value,estimated_duration_min:s.estimated_duration_min,workout_type:s.workout_type,is_template:!1}).select().single();if(n)throw n;const{data:o,error:i}=await u.from("exercises").select("*").eq("workout_id",s.id).order("order_index");if(i)throw i;if(o&&o.length>0){const c=o.map(l=>({workout_id:e.id,name:l.name,description:l.description,order_index:l.order_index,sets:l.sets,reps:l.reps,weight_kg:l.weight_kg,duration_seconds:l.duration_seconds,distance_meters:l.distance_meters,rpe:l.rpe,intensity_percent:l.intensity_percent,target_time_seconds:l.target_time_seconds,rest_seconds:l.rest_seconds,notes:l.notes,video_url:l.video_url})),{error:C}=await u.from("exercises").insert(c);if(C)throw C}await j(),B()}catch(e){console.error("Error assigning workout:",e),alert("Failed to assign workout")}}async function L(s){if(confirm("Remove this workout from the program?"))try{const{error:e}=await u.from("workouts").delete().eq("id",s).eq("coach_id",v.user.id);if(e)throw e;await j()}catch(e){console.error("Error removing workout:",e),alert("Failed to remove workout")}}function x(s,e){return s.workouts?.find(n=>n.day_of_week===e)}function P(s){const e=M.find(n=>n.value===s);return e?e.label.substring(0,3):""}return(s,e)=>{const n=J("router-link");return a(),r("div",Q,[t("div",U,[t("div",X,[t("button",{onClick:e[0]||(e[0]=o=>S(W).push("/programs")),class:"p-2 hover:bg-gray-100 rounded-lg -ml-2"},[...e[1]||(e[1]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 19l-7-7 7-7"})],-1)])]),t("div",Z,[t("h1",ee,d(g.value?.name||"Program"),1),t("p",te,d(k.value.length)+" week"+d(k.value.length!==1?"s":""),1)])])]),D.value?(a(),r("div",oe,[t("div",se,[(a(),r(w,null,_(3,o=>t("div",{key:o},[e[2]||(e[2]=t("div",{class:"h-6 bg-gray-200 rounded w-32 mb-3"},null,-1)),t("div",re,[(a(),r(w,null,_(7,i=>t("div",{key:i,class:"h-20 bg-gray-100 rounded"})),64))])])),64))])])):(a(),r("div",ae,[g.value?.description?(a(),r("div",ne,[t("p",ie,d(g.value.description),1)])):p("",!0),h.value.length===0?(a(),r("div",le,[t("p",de,[e[4]||(e[4]=f(" ðŸ’¡ ",-1)),e[5]||(e[5]=t("strong",null,"Tip:",-1)),e[6]||(e[6]=f(" You don't have any standalone workouts yet. ",-1)),$(n,{to:"/workouts",class:"underline"},{default:F(()=>[...e[3]||(e[3]=[f("Create some workouts",-1)])]),_:1}),e[7]||(e[7]=f(" first, then come back to assign them to your program. ",-1))])])):p("",!0),(a(!0),r(w,null,_(k.value,o=>(a(),r("div",{key:o.id,class:"space-y-3"},[t("h3",ue,d(o.name),1),t("div",ce,[(a(),r(w,null,_(M,i=>t("div",{key:i.value,class:"aspect-square"},[x(o,i.value)?(a(),r("div",{key:0,class:"h-full card p-2 flex flex-col justify-between bg-summit-50 border-summit-200 cursor-pointer hover:shadow-md transition-shadow",onClick:c=>S(W).push(`/workouts/${x(o,i.value).id}/edit`)},[t("div",ve,d(P(i.value)),1),t("div",ge,d(x(o,i.value).name),1),t("button",{onClick:z(c=>L(x(o,i.value).id),["stop"]),class:"text-xs text-red-600 hover:text-red-700"}," Remove ",8,pe)],8,me)):(a(),r("button",{key:1,onClick:c=>T(o.id,i.value),class:"h-full w-full border-2 border-dashed border-gray-300 rounded-xl hover:border-summit-500 hover:bg-summit-50 transition-colors flex flex-col items-center justify-center gap-1 text-gray-400 hover:text-summit-700"},[t("div",ke,d(P(i.value)),1),e[8]||(e[8]=t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})],-1))],8,fe))])),64))])]))),128)),e[9]||(e[9]=t("div",{class:"card p-4 bg-gray-50"},[t("p",{class:"text-sm text-gray-600"},[t("strong",null,"How it works:"),f(" Click any day to assign a workout. Workouts are copied from your library so you can customize them for each week. ")])],-1))])),E.value?(a(),r("div",{key:2,class:"fixed inset-0 z-50 flex items-end sm:items-center justify-center bg-black bg-opacity-50",onClick:z(B,["self"])},[t("div",we,[t("div",{class:"p-4 border-b border-feed-border flex items-center justify-between flex-shrink-0"},[e[11]||(e[11]=t("h2",{class:"font-semibold text-lg"},"Select Workout",-1)),t("button",{onClick:B,class:"w-8 h-8 rounded-full hover:bg-gray-100 flex items-center justify-center"},[...e[10]||(e[10]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),t("div",_e,[h.value.length===0?(a(),r("div",he,[e[13]||(e[13]=t("p",null,"No workouts available.",-1)),$(n,{to:"/workouts",class:"text-summit-700 underline text-sm"},{default:F(()=>[...e[12]||(e[12]=[f(" Create a workout first ",-1)])]),_:1})])):p("",!0),(a(!0),r(w,null,_(h.value,o=>(a(),r("button",{key:o.id,onClick:i=>I(o),class:"w-full text-left p-3 rounded-xl hover:bg-gray-50 border border-gray-200 hover:border-summit-300 transition-colors"},[t("h4",be,d(o.name),1),o.description?(a(),r("p",xe,d(o.description),1)):p("",!0),o.workout_type?(a(),r("div",Ce,d(o.workout_type),1)):p("",!0)],8,ye))),128))])])])):p("",!0)])}}});export{qe as default};
