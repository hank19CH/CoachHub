import{d as H,u as E,r as i,m as J,c as a,a as e,y as K,t as o,b as v,f,F as w,n as M,z as D,g as j,D as P,w as B,C as Q,v as W,k as X,q as Y,s as G,o as l,p as $,l as Z}from"./index-CR_8Ibs2.js";import{e as ee,f as z,h as te,r as se,i as le}from"./groups-2rhu8182.js";const ae={class:"pb-20"},oe={class:"sticky top-0 bg-white/90 backdrop-blur-sm z-10 border-b border-gray-100"},ne={class:"flex items-center justify-between p-4"},re={class:"font-display text-lg font-semibold text-gray-900 truncate"},ie={key:0,class:"p-6"},ue={key:1,class:"p-4 space-y-6"},de={class:"card p-4"},ce={class:"flex items-start gap-3"},ve={class:"w-14 h-14 rounded-xl bg-gradient-to-br from-summit-600 to-summit-800 flex items-center justify-center text-white font-bold text-lg flex-shrink-0"},me={key:0},pe={key:1},ge={class:"font-display text-xl font-bold text-gray-900"},fe={key:0,class:"text-sm text-summit-600 font-medium"},xe={key:1,class:"text-sm text-gray-500"},ye={key:2,class:"text-sm text-gray-600 mt-2"},be={class:"flex items-center justify-between mb-3"},he={class:"font-semibold text-gray-900"},we={class:"text-gray-400 font-normal"},_e={key:0,class:"card p-6 text-center text-gray-500 text-sm"},ke={key:1,class:"grid grid-cols-2 gap-3"},Ce=["src","alt"],Ae={key:1,class:"w-10 h-10 rounded-full bg-gradient-to-br from-summit-600 to-summit-800 flex items-center justify-center text-white font-semibold text-xs flex-shrink-0"},Me={class:"flex-1 min-w-0"},je={class:"text-sm font-medium text-gray-900 truncate"},Se={class:"text-xs text-gray-500 truncate"},De=["onClick"],Pe={class:"flex items-center justify-between mb-3"},Be=["disabled"],Ge={class:"text-sm text-gray-500"},$e={class:"bg-white rounded-t-2xl sm:rounded-2xl w-full sm:max-w-md p-6 max-h-[80vh] overflow-y-auto"},ze={key:0,class:"text-center py-8 text-gray-500 text-sm"},Te={key:1,class:"space-y-2 mb-6"},qe=["onClick"],Ve=["src","alt"],Ie={key:1,class:"w-10 h-10 rounded-full bg-gradient-to-br from-summit-600 to-summit-800 flex items-center justify-center text-white font-semibold text-xs"},Re={class:"flex-1 text-left"},Le={class:"text-sm font-medium text-gray-900"},Ne={class:"text-xs text-gray-500"},Oe={key:0,class:"w-3 h-3 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"3"},Ue={class:"flex gap-3"},Fe=["disabled"],He=["disabled"],Ee={key:0,class:"flex items-center gap-2"},Je={key:1},Ke={class:"bg-white rounded-t-2xl sm:rounded-2xl w-full sm:max-w-md p-6 max-h-[80vh] overflow-y-auto"},Qe={key:0,class:"text-center py-6"},We={class:"text-sm text-gray-600"},Xe={key:1,class:"mb-4 p-3 bg-red-50 text-red-700 rounded-xl text-sm"},Ye=["value"],Ze={class:"text-sm text-gray-500"},et={class:"flex gap-3 pt-2"},tt=["disabled"],st=["disabled"],lt={key:0,class:"flex items-center gap-2"},at={key:1},it=H({__name:"GroupDetailView",setup(ot){const T=Z(),q=X(),m=E(),r=i(null),d=i([]),k=i(!0),x=i(!1),C=i([]),u=i([]),y=i(!1),b=i(!1),S=i([]),p=i(""),_=i(new Date().toISOString().split("T")[0]),h=i(!1),c=i(null),g=Y(()=>T.params.id);J(async()=>{await V()});async function V(){k.value=!0;const[n,t]=await Promise.all([ee(g.value),z(g.value)]);r.value=n,d.value=t,k.value=!1}async function I(){if(!m.user)return;const{data:n}=await G.from("coach_athletes").select("athlete:profiles!athlete_id(id, username, display_name, avatar_url)").eq("coach_id",m.user.id).eq("status","active"),t=new Set(d.value.map(s=>s.athlete_id));C.value=(n||[]).map(s=>Array.isArray(s.athlete)?s.athlete[0]:s.athlete).filter(s=>s&&!t.has(s.id)),u.value=[],x.value=!0}function R(n){const t=u.value.indexOf(n);t>=0?u.value.splice(t,1):u.value.push(n)}async function L(){u.value.length!==0&&(y.value=!0,await te(g.value,u.value),d.value=await z(g.value),x.value=!1,y.value=!1)}async function N(n){await se(g.value,n)&&(d.value=d.value.filter(s=>s.athlete_id!==n))}async function O(){if(!m.user)return;const{data:n}=await G.from("programs").select("id, name, duration_weeks, difficulty").eq("coach_id",m.user.id).order("name");S.value=n||[],p.value="",c.value=null,_.value=new Date().toISOString().split("T")[0],b.value=!0}async function U(){if(!p.value||!m.user)return;h.value=!0;const n=await le(p.value,g.value,m.user.id,_.value);c.value=n,h.value=!1}function A(n){return n?.split(" ").map(t=>t[0]).join("").toUpperCase().slice(0,2)??"?"}return(n,t)=>(l(),a(w,null,[e("div",ae,[e("div",oe,[e("div",ne,[e("button",{onClick:t[0]||(t[0]=s=>K(q).back()),class:"text-gray-600 hover:text-gray-900 p-1"},[...t[8]||(t[8]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 19l-7-7 7-7"})],-1)])]),e("h1",re,o(r.value?.name||"Group"),1),t[9]||(t[9]=e("div",{class:"w-8"},null,-1))])]),k.value?(l(),a("div",ie,[...t[10]||(t[10]=[e("div",{class:"animate-pulse space-y-4"},[e("div",{class:"h-6 w-48 bg-gray-200 rounded"}),e("div",{class:"h-4 w-32 bg-gray-200 rounded"}),e("div",{class:"h-20 bg-gray-200 rounded-xl"})],-1)])])):r.value?(l(),a("div",ue,[e("div",de,[e("div",ce,[e("div",ve,[r.value.sport?.icon?(l(),a("span",me,o(r.value.sport.icon),1)):(l(),a("span",pe,o(A(r.value.name)),1))]),e("div",null,[e("h2",ge,o(r.value.name),1),r.value.team?(l(),a("p",fe,o(r.value.team.name),1)):v("",!0),r.value.sport?(l(),a("p",xe,o(r.value.sport.name),1)):v("",!0),r.value.description?(l(),a("p",ye,o(r.value.description),1)):v("",!0)])])]),e("div",null,[e("div",be,[e("h3",he,[t[11]||(t[11]=f(" Members ",-1)),e("span",we,"("+o(d.value.length)+")",1)]),e("button",{onClick:I,class:"btn-sm btn-primary"},[...t[12]||(t[12]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"})],-1),f(" Add ",-1)])])]),d.value.length===0?(l(),a("div",_e," No members yet. Add athletes to this group. ")):(l(),a("div",ke,[(l(!0),a(w,null,M(d.value,s=>(l(),a("div",{key:s.id,class:"card p-3 flex items-center gap-3"},[s.athlete?.avatar_url?(l(),a("img",{key:0,src:s.athlete.avatar_url,alt:s.athlete.display_name,class:"w-10 h-10 rounded-full object-cover"},null,8,Ce)):(l(),a("div",Ae,o(A(s.athlete?.display_name||"?")),1)),e("div",Me,[e("p",je,o(s.athlete?.display_name),1),e("p",Se,"@"+o(s.athlete?.username),1)]),e("button",{onClick:F=>N(s.athlete_id),class:"p-1 text-gray-400 hover:text-red-500 transition-colors flex-shrink-0",title:"Remove"},[...t[13]||(t[13]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,De)]))),128))]))]),e("div",null,[e("div",Pe,[t[15]||(t[15]=e("h3",{class:"font-semibold text-gray-900"},"Programs",-1)),e("button",{onClick:O,class:"btn-sm btn-primary",disabled:d.value.length===0},[...t[14]||(t[14]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4v16m8-8H4"})],-1),f(" Assign Program ",-1)])],8,Be)]),e("p",Ge," Assign a program to this group to create workout assignments for all "+o(d.value.length)+" members. ",1)])])):v("",!0)]),(l(),D(P,{to:"body"},[x.value?(l(),a("div",{key:0,class:"fixed inset-0 z-50 flex items-end sm:items-center justify-center bg-black/50",onClick:t[2]||(t[2]=j(s=>x.value=!1,["self"]))},[e("div",$e,[t[18]||(t[18]=e("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Add Athletes",-1)),C.value.length===0?(l(),a("div",ze," All your athletes are already in this group. ")):(l(),a("div",Te,[(l(!0),a(w,null,M(C.value,s=>(l(),a("button",{key:s.id,onClick:F=>R(s.id),class:$(["w-full flex items-center gap-3 p-3 rounded-xl transition-colors",u.value.includes(s.id)?"bg-summit-50 ring-2 ring-summit-500":"hover:bg-gray-50"])},[s.avatar_url?(l(),a("img",{key:0,src:s.avatar_url,alt:s.display_name,class:"w-10 h-10 rounded-full object-cover"},null,8,Ve)):(l(),a("div",Ie,o(A(s.display_name)),1)),e("div",Re,[e("p",Le,o(s.display_name),1),e("p",Ne,"@"+o(s.username),1)]),e("div",{class:$(["w-5 h-5 rounded-full border-2 flex items-center justify-center",u.value.includes(s.id)?"border-summit-600 bg-summit-600":"border-gray-300"])},[u.value.includes(s.id)?(l(),a("svg",Oe,[...t[16]||(t[16]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M5 13l4 4L19 7"},null,-1)])])):v("",!0)],2)],10,qe))),128))])),e("div",Ue,[e("button",{onClick:t[1]||(t[1]=s=>x.value=!1),class:"flex-1 btn-secondary",disabled:y.value},"Cancel",8,Fe),e("button",{onClick:L,class:"flex-1 btn-primary",disabled:u.value.length===0||y.value},[y.value?(l(),a("span",Ee,[...t[17]||(t[17]=[e("div",{class:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"},null,-1)])])):(l(),a("span",Je,"Add "+o(u.value.length)+" Athlete"+o(u.value.length!==1?"s":""),1))],8,He)])])])):v("",!0)])),(l(),D(P,{to:"body"},[b.value?(l(),a("div",{key:0,class:"fixed inset-0 z-50 flex items-end sm:items-center justify-center bg-black/50",onClick:t[7]||(t[7]=j(s=>b.value=!1,["self"]))},[e("div",Ke,[t[25]||(t[25]=e("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Assign Program to Group",-1)),c.value?.success?(l(),a("div",Qe,[t[19]||(t[19]=e("div",{class:"w-16 h-16 mx-auto mb-4 rounded-full bg-green-100 flex items-center justify-center"},[e("svg",{class:"w-8 h-8 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M5 13l4 4L19 7"})])],-1)),t[20]||(t[20]=e("p",{class:"font-semibold text-gray-900 mb-1"},"Program Assigned!",-1)),e("p",We," Created "+o(c.value.assignmentCount)+" workout assignments ("+o(c.value.workoutCount)+" workouts x "+o(c.value.memberCount)+" athletes) ",1),e("button",{onClick:t[3]||(t[3]=s=>b.value=!1),class:"btn-primary mt-6"},"Done")])):c.value&&!c.value.success?(l(),a("div",Xe,o(c.value.error),1)):v("",!0),c.value?.success?v("",!0):(l(),a("form",{key:2,onSubmit:j(U,["prevent"]),class:"space-y-4"},[e("div",null,[t[22]||(t[22]=e("label",{class:"label"},"Program *",-1)),B(e("select",{"onUpdate:modelValue":t[4]||(t[4]=s=>p.value=s),class:"input",required:""},[t[21]||(t[21]=e("option",{value:""},"Select a program",-1)),(l(!0),a(w,null,M(S.value,s=>(l(),a("option",{key:s.id,value:s.id},[f(o(s.name)+" ",1),s.duration_weeks?(l(),a(w,{key:0},[f(" ("+o(s.duration_weeks)+" weeks)",1)],64)):v("",!0)],8,Ye))),128))],512),[[Q,p.value]])]),e("div",null,[t[23]||(t[23]=e("label",{class:"label"},"Start Date *",-1)),B(e("input",{"onUpdate:modelValue":t[5]||(t[5]=s=>_.value=s),type:"date",class:"input",required:""},null,512),[[W,_.value]])]),e("p",Ze," This will create individual workout assignments for all "+o(d.value.length)+" athletes in this group. ",1),e("div",et,[e("button",{type:"button",onClick:t[6]||(t[6]=s=>b.value=!1),class:"flex-1 btn-secondary",disabled:h.value},"Cancel",8,tt),e("button",{type:"submit",class:"flex-1 btn-primary",disabled:h.value||!p.value},[h.value?(l(),a("span",lt,[...t[24]||(t[24]=[e("div",{class:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"},null,-1),f(" Assigning... ",-1)])])):(l(),a("span",at,"Assign Program"))],8,st)])],32))])])):v("",!0)]))],64))}});export{it as default};
