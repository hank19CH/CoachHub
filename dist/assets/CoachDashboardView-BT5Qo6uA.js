import{d as b,c as r,a as t,t as u,f as S,o,u as D,m as $,s as R,F as _,n as h,p as w,E,r as p,z as k,b as B,h as L,w as A,C,q as P}from"./index-CR_8Ibs2.js";import{g as V,_ as N}from"./WorkoutCompletionCard.vue_vue_type_script_setup_true_lang-C4cEKwoY.js";import{f as j}from"./format-HA5A4YDt.js";import{a as q}from"./addDays-BsqNNgc4.js";function z(f,x,s){return q(f,-7,s)}const F={class:"grid grid-cols-3 gap-3"},U={class:"card p-4 flex items-center gap-3"},I={class:"text-xl font-bold text-gray-900"},T={class:"card p-4 flex items-center gap-3"},O={class:"text-xl font-bold text-gray-900"},G={class:"card p-4 flex items-center gap-3"},H={class:"text-xl font-bold text-gray-900"},J=b({__name:"ComplianceMetrics",props:{stats:{}},setup(f){return(x,s)=>(o(),r("div",F,[t("div",U,[s[1]||(s[1]=t("span",{class:"text-2xl"},"âœ…",-1)),t("div",null,[t("p",I,u(f.stats.totalCompletions),1),s[0]||(s[0]=t("p",{class:"text-xs text-gray-600"},"Completed",-1))])]),t("div",T,[s[3]||(s[3]=t("span",{class:"text-2xl"},"ðŸ†",-1)),t("div",null,[t("p",O,u(f.stats.totalPBs),1),s[2]||(s[2]=t("p",{class:"text-xs text-gray-600"},"Personal Bests",-1))])]),t("div",G,[s[6]||(s[6]=t("span",{class:"text-2xl"},"â±ï¸",-1)),t("div",null,[t("p",H,[S(u(f.stats.avgDuration),1),s[4]||(s[4]=t("span",{class:"text-sm font-normal"},"m",-1))]),s[5]||(s[5]=t("p",{class:"text-xs text-gray-600"},"Avg Duration",-1))])])]))}}),K={class:"card p-4"},Q={key:0,class:"space-y-3"},W={key:1,class:"space-y-3"},X={key:0,class:"w-8 h-8 rounded-full overflow-hidden flex-shrink-0"},Y=["src","alt"],Z={key:1,class:"w-8 h-8 rounded-full bg-summit-600 text-white flex items-center justify-center text-xs font-semibold flex-shrink-0"},tt={class:"flex-1 min-w-0"},et={class:"flex items-center justify-between mb-1"},st={class:"text-sm font-medium text-gray-900 truncate"},at={class:"h-1.5 bg-gray-200 rounded-full overflow-hidden"},lt={class:"text-xs text-gray-500 mt-0.5"},ot={key:2,class:"text-center py-4 text-sm text-gray-500"},nt=b({__name:"AthleteProgressSummary",setup(f){const x=D(),s=p(!0),v=p([]);$(async()=>{if(x.user)try{s.value=!0;const i=j(z(new Date,7),"yyyy-MM-dd"),{data:c,error:a}=await R.from("workout_assignments").select(`
        id,
        athlete_id,
        status,
        assigned_date,
        profiles!workout_assignments_athlete_id_fkey (
          id,
          display_name,
          avatar_url
        )
      `).eq("coach_id",x.user.id).gte("assigned_date",i);if(a)throw a;const m=new Map;(c||[]).forEach(l=>{const e=Array.isArray(l.profiles)?l.profiles[0]:l.profiles;if(!e)return;m.has(e.id)||m.set(e.id,{id:e.id,display_name:e.display_name,avatar_url:e.avatar_url,totalAssigned:0,totalCompleted:0,completionRate:0});const n=m.get(e.id);n.totalAssigned++,l.status==="completed"&&n.totalCompleted++}),m.forEach(l=>{l.completionRate=l.totalAssigned>0?Math.round(l.totalCompleted/l.totalAssigned*100):0}),v.value=Array.from(m.values()).sort((l,e)=>e.completionRate-l.completionRate)}catch(i){console.error("Error loading athlete progress:",i)}finally{s.value=!1}});function y(i){return i>=80?"bg-green-500":i>=60?"bg-blue-500":i>=40?"bg-yellow-500":"bg-red-400"}function g(i){return i>=80?"text-green-700":i>=60?"text-blue-700":i>=40?"text-yellow-700":"text-red-600"}return(i,c)=>(o(),r("div",K,[c[1]||(c[1]=t("h3",{class:"font-semibold text-gray-900 mb-4"},"Athlete Progress (7 days)",-1)),s.value?(o(),r("div",Q,[(o(),r(_,null,h(3,a=>t("div",{key:a,class:"animate-pulse flex items-center gap-3"},[...c[0]||(c[0]=[t("div",{class:"w-8 h-8 bg-gray-200 rounded-full"},null,-1),t("div",{class:"flex-1"},[t("div",{class:"h-4 bg-gray-200 rounded w-24 mb-1"}),t("div",{class:"h-1.5 bg-gray-200 rounded-full"})],-1)])])),64))])):v.value.length>0?(o(),r("div",W,[(o(!0),r(_,null,h(v.value,a=>(o(),r("div",{key:a.id,class:"flex items-center gap-3"},[a.avatar_url?(o(),r("div",X,[t("img",{src:a.avatar_url,alt:a.display_name,class:"w-full h-full object-cover"},null,8,Y)])):(o(),r("div",Z,u(a.display_name.charAt(0).toUpperCase()),1)),t("div",tt,[t("div",et,[t("span",st,u(a.display_name),1),t("span",{class:w(["text-xs font-semibold ml-2",g(a.completionRate)])},u(a.completionRate)+"% ",3)]),t("div",at,[t("div",{class:w(["h-full rounded-full transition-all duration-500",y(a.completionRate)]),style:E({width:`${a.completionRate}%`})},null,6)]),t("div",lt,u(a.totalCompleted)+"/"+u(a.totalAssigned)+" workouts ",1)])]))),128))])):(o(),r("div",ot," No athlete activity this week "))]))}}),rt={class:"max-w-2xl mx-auto px-4 py-6"},it={class:"mt-6 flex gap-3"},dt=["value"],ut={key:1,class:"mt-8 text-center py-12"},ct={key:2,class:"mt-8 p-4 bg-red-50 border border-red-200 rounded-xl"},mt={class:"text-red-800 text-sm"},pt={key:3,class:"mt-8 text-center py-16"},ft={key:4,class:"mt-6 space-y-4 pb-20"},_t=b({__name:"CoachDashboardView",setup(f){const x=D(),s=p([]),v=p(!0),y=p(null),g=p("all"),i=p(7),c=p([]);$(async()=>{await a()});async function a(){v.value=!0,y.value=null;try{const l={limit:50};if(g.value!=="all"&&(l.athleteId=g.value),i.value){const d=new Date;d.setDate(d.getDate()-i.value),l.startDate=d.toISOString()}const e=await V(x.user.id,l);s.value=e;const n=new Map;e.forEach(d=>{d.athlete&&!n.has(d.athlete.id)&&n.set(d.athlete.id,d.athlete)}),c.value=Array.from(n.values())}catch(l){console.error("Error fetching completions:",l),y.value=l.message}finally{v.value=!1}}const m=P(()=>{if(!s.value.length)return null;const l=s.value.length,e=s.value.filter(d=>d.has_pb).length,n=Math.round(s.value.reduce((d,M)=>d+(M.duration_minutes||0),0)/l);return{totalCompletions:l,totalPBs:e,avgDuration:n}});return(l,e)=>(o(),r("div",rt,[e[6]||(e[6]=t("div",{class:"border-b border-gray-200 pb-4"},[t("h1",{class:"text-2xl font-bold text-gray-900"},"Athlete Activity"),t("p",{class:"text-gray-600 mt-1 text-sm"},"Monitor workout completions and provide feedback")],-1)),m.value?(o(),k(J,{key:0,stats:m.value,class:"mt-6"},null,8,["stats"])):B("",!0),L(nt,{class:"mt-6"}),t("div",it,[A(t("select",{"onUpdate:modelValue":e[0]||(e[0]=n=>g.value=n),onChange:a,class:"input text-sm !py-2"},[e[2]||(e[2]=t("option",{value:"all"},"All Athletes",-1)),(o(!0),r(_,null,h(c.value,n=>(o(),r("option",{key:n.id,value:n.id},u(n.display_name),9,dt))),128))],544),[[C,g.value]]),A(t("select",{"onUpdate:modelValue":e[1]||(e[1]=n=>i.value=n),onChange:a,class:"input text-sm !py-2"},[...e[3]||(e[3]=[t("option",{value:7},"Last 7 Days",-1),t("option",{value:14},"Last 14 Days",-1),t("option",{value:30},"Last 30 Days",-1),t("option",{value:null},"All Time",-1)])],544),[[C,i.value]])]),v.value?(o(),r("div",ut,[...e[4]||(e[4]=[t("div",{class:"animate-spin h-8 w-8 border-4 border-summit-800 border-t-transparent rounded-full mx-auto"},null,-1),t("p",{class:"mt-3 text-gray-600 text-sm"},"Loading activity...",-1)])])):y.value?(o(),r("div",ct,[t("p",mt,u(y.value),1)])):s.value.length?(o(),r("div",ft,[(o(!0),r(_,null,h(s.value,n=>(o(),k(N,{key:n.id,completion:n,onFeedbackAdded:a},null,8,["completion"]))),128))])):(o(),r("div",pt,[...e[5]||(e[5]=[t("div",{class:"text-4xl mb-3"},"ðŸ“Š",-1),t("p",{class:"text-gray-600 font-medium"},"No workout completions found",-1),t("p",{class:"text-sm text-gray-500 mt-1"}," Completions will appear here once athletes finish workouts ",-1)])]))]))}});export{_t as default};
