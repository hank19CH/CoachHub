import{d as M,o as m,c as f,g as b,p as C,a as u,t as k,b as E,F as z,n as $,r as w,q as B,s as p}from"./index-B256TZ31.js";const F={class:"text-sm text-gray-600 font-medium"},S={class:"text-xs text-gray-400 mt-1"},U={key:1,class:"text-sm text-red-600 mt-2"},j={key:2,class:"mt-3 flex gap-2 overflow-x-auto pb-2"},L=["src"],P={key:1,class:"w-full h-full flex items-center justify-center bg-gray-800"},V={class:"absolute bottom-0 left-0 right-0 bg-black/50 text-white text-[10px] text-center py-0.5"},W=["onClick"],O=M({__name:"MediaUploadZone",props:{maxFiles:{default:10},maxImageSize:{default:10*1024*1024},maxVideoSize:{default:50*1024*1024}},emits:["filesChanged"],setup(o,{emit:c}){const s=o,l=c,r=w([]),n=w([]),i=w(!1),a=w(""),v=B(()=>r.value.length<s.maxFiles);function h(t){i.value=!1,t.dataTransfer?.files&&y(Array.from(t.dataTransfer.files))}function g(t){const e=t.target;e.files&&(y(Array.from(e.files)),e.value="")}function y(t){a.value="";for(const e of t){if(r.value.length>=s.maxFiles){a.value=`Maximum ${s.maxFiles} files allowed`;break}const d=e.type.startsWith("image/"),_=e.type.startsWith("video/");if(!d&&!_){a.value="Only images and videos are allowed";continue}if(d&&e.size>s.maxImageSize){a.value=`Images must be under ${Math.round(s.maxImageSize/1024/1024)}MB`;continue}if(_&&e.size>s.maxVideoSize){a.value=`Videos must be under ${Math.round(s.maxVideoSize/1024/1024)}MB`;continue}r.value.push(e),n.value.push({url:URL.createObjectURL(e),type:d?"image":"video"})}l("filesChanged",[...r.value])}function x(t){URL.revokeObjectURL(n.value[t].url),r.value.splice(t,1),n.value.splice(t,1),a.value="",l("filesChanged",[...r.value])}function I(t){return t<1024?t+"B":t<1024*1024?(t/1024).toFixed(1)+"KB":(t/1024/1024).toFixed(1)+"MB"}return(t,e)=>(m(),f("div",null,[v.value?(m(),f("div",{key:0,class:C(["border-2 border-dashed rounded-xl p-6 text-center transition-colors cursor-pointer",i.value?"border-summit-500 bg-summit-50":"border-gray-300 hover:border-gray-400"]),onDragover:e[0]||(e[0]=b(d=>i.value=!0,["prevent"])),onDragleave:e[1]||(e[1]=d=>i.value=!1),onDrop:b(h,["prevent"]),onClick:e[2]||(e[2]=d=>t.$refs.fileInput.click())},[u("input",{ref:"fileInput",type:"file",multiple:"",accept:"image/jpeg,image/png,image/webp,video/mp4,video/quicktime",class:"hidden",onChange:g},null,544),e[3]||(e[3]=u("svg",{class:"w-10 h-10 mx-auto text-gray-400 mb-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[u("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)),u("p",F,k(i.value?"Drop files here":"Tap to add photos or videos"),1),u("p",S,k(r.value.length)+"/"+k(o.maxFiles)+" files ",1)],34)):E("",!0),a.value?(m(),f("p",U,k(a.value),1)):E("",!0),n.value.length>0?(m(),f("div",j,[(m(!0),f(z,null,$(n.value,(d,_)=>(m(),f("div",{key:_,class:"relative flex-shrink-0 w-20 h-20 rounded-lg overflow-hidden bg-gray-100"},[d.type==="image"?(m(),f("img",{key:0,src:d.url,class:"w-full h-full object-cover"},null,8,L)):(m(),f("div",P,[...e[4]||(e[4]=[u("svg",{class:"w-8 h-8 text-white",fill:"currentColor",viewBox:"0 0 20 20"},[u("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z","clip-rule":"evenodd"})],-1)])])),u("div",V,k(I(r.value[_].size)),1),u("button",{onClick:b(q=>x(_),["stop"]),class:"absolute top-0.5 right-0.5 w-5 h-5 rounded-full bg-black/60 text-white flex items-center justify-center hover:bg-black/80"},[...e[5]||(e[5]=[u("svg",{class:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[u("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,W)]))),128))])):E("",!0)]))}});async function R(o,c,s){try{const l=o.name.split(".").pop(),r=`${c}/${s}/${crypto.randomUUID()}.${l}`,{data:n,error:i}=await p.storage.from("post-media").upload(r,o,{cacheControl:"3600",upsert:!1});if(i)return console.error("Error uploading media:",i),null;const{data:{publicUrl:a}}=p.storage.from("post-media").getPublicUrl(n.path);return a}catch(l){return console.error("Error in uploadPostMedia:",l),null}}async function N(o,c){try{const{error:s}=await p.from("workout_completions").update({caption:o.caption,shared_exercise_ids:o.sharedExerciseIds,share_settings:o.shareSettings}).eq("id",o.completionId);if(s)return console.error("Error updating workout_completions:",s),null;const{data:l,error:r}=await p.from("workout_completions").select("athlete_id").eq("id",o.completionId).single();if(r||!l)return console.error("Error fetching completion:",r),null;const n={author_id:l.athlete_id,content:o.caption,post_type:"workout",workout_completion_id:o.completionId,visibility:o.visibility,is_pinned:!1,likes_count:0,comments_count:0},{data:i,error:a}=await p.from("posts").insert(n).select().single();if(a||!i)return console.error("Error creating post:",a),null;if(c.length>0){const h=c.map((y,x)=>({post_id:i.id,media_type:y.type,url:y.url,display_order:x,alt_text:`Workout media ${x+1}`})),{error:g}=await p.from("post_media").insert(h);g&&console.error("Error creating post_media:",g)}const v={post_id:i.id,media_type:"workout_card",url:null,display_order:c.length,alt_text:"Workout summary card"};return await p.from("post_media").insert(v),i}catch(s){return console.error("Error in createWorkoutPost:",s),null}}async function T(o,c,s,l){try{const r={author_id:o,content:c||null,post_type:"manual",visibility:s,is_pinned:!1,likes_count:0,comments_count:0},{data:n,error:i}=await p.from("posts").insert(r).select().single();if(i||!n)return console.error("Error creating post:",i),null;if(l.length>0){const a=l.map((h,g)=>({post_id:n.id,media_type:h.type,url:h.url,display_order:g,alt_text:`Post media ${g+1}`})),{error:v}=await p.from("post_media").insert(a);v&&console.error("Error creating post_media:",v)}return n}catch(r){return console.error("Error in createPost:",r),null}}export{O as _,N as a,T as c,R as u};
