import{d as q,u as T,m as Y,x as D,s as B,c as n,a as t,p as L,F as w,f as p,t as z,y as $,h as C,i as E,n as H,T as G,b as R,r as _,j as W,o as r,z as U,_ as Z}from"./index-DoIKaNgo.js";import{_ as J,P as K}from"./PostSkeleton-By8O5vwQ.js";import"./MediaCarousel.vue_vue_type_script_setup_true_lang-cAo-VpB0.js";import"./WorkoutCard.vue_vue_type_script_setup_true_lang-Cnp1jYFM.js";const O={class:"min-h-full"},Q={class:"sticky top-0 bg-white/90 backdrop-blur-sm z-10 border-b border-gray-100"},X={class:"flex"},ee={key:0,class:"p-6 text-center"},te={class:"font-display text-2xl font-bold text-gray-900 mb-2"},oe={class:"text-gray-600 mb-6 max-w-sm mx-auto"},se={class:"flex flex-col sm:flex-row gap-3 justify-center"},re={key:1,class:"space-y-4 p-4"},le={key:2,class:"p-6 text-center"},ne={class:"text-gray-600 text-sm mb-4"},ie={key:3,class:"pb-4"},ae={key:0,class:"flex justify-center py-6"},ue={key:1,class:"text-center py-8 text-gray-400 text-sm"},V=20,ce=q({__name:"FeedView",setup(de){const g=T(),u=_([]),y=_(!0),x=_(!1),k=_(null),h=_(!0),f=_("all");Y(async()=>{await b(),window.addEventListener("scroll",P)}),D(()=>{window.removeEventListener("scroll",P)});async function F(i){f.value!==i&&(f.value=i,h.value=!0,await b())}async function b(i=!1){try{i||(y.value=!0,k.value=null);const e=i?u.value.length:0;let c=B.from("posts").select(`
        *,
        author:profiles!author_id(*),
        media:post_media(*),
        workout_completion:workout_completions!posts_workout_completion_id_fkey(
          id,
          duration_minutes,
          overall_rpe,
          has_pb,
          completed_at,
          shared_exercise_ids,
          share_settings,
          assignment:workout_assignments!workout_completions_assignment_id_fkey(
            workout:workouts!workout_assignments_workout_id_fkey(
              id,
              name,
              description
            )
          )
        )
      `);if(f.value==="following"&&g.user){const{data:s}=await B.from("follows").select("following_id").eq("follower_id",g.user.id).eq("status","active"),m=(s||[]).map(a=>a.following_id);m.push(g.user.id),c=c.in("author_id",m).in("visibility",["public","followers"])}else c=c.eq("visibility","public");const{data:d,error:M}=await c.order("created_at",{ascending:!1}).range(e,e+V-1);if(M)throw M;const v=(d||[]).map(s=>{const m=Array.isArray(s.author)?s.author[0]:s.author,a=s.media||[];let o=Array.isArray(s.workout_completion)?s.workout_completion[0]??null:s.workout_completion??null;if(o){const l=Array.isArray(o.assignment)?o.assignment[0]??null:o.assignment??null;l&&(l.workout=Array.isArray(l.workout)?l.workout[0]??null:l.workout??null),o={...o,assignment:l}}return{...s,author:m,media:a,workout_completion:o}}),S=v.filter(s=>s.post_type==="workout"&&s.workout_completion);if(S.length>0){const s=S.map(a=>a.workout_completion.id),{data:m}=await B.from("exercise_results").select(`
          id,
          completion_id,
          is_pb,
          exercise:exercises!exercise_results_exercise_id_fkey(
            id,
            name,
            sets,
            reps,
            weight_kg,
            duration_seconds,
            distance_meters
          )
        `).in("completion_id",s);if(m){for(const o of m)Array.isArray(o.exercise)&&(o.exercise=o.exercise[0]??null);const a=new Map;for(const o of m){const l=a.get(o.completion_id)||[];l.push(o),a.set(o.completion_id,l)}for(const o of v)if(o.workout_completion){const l=o.workout_completion.shared_exercise_ids;let A=a.get(o.workout_completion.id)||[];l&&l.length>0&&(A=A.filter(N=>l.includes(N.exercise?.id))),o.workout_completion.exercise_results=A}}}i?u.value.push(...v):u.value=v,h.value=v.length>=V}catch(e){k.value=e instanceof Error?e.message:"Failed to load posts",console.error("Error fetching posts:",e)}finally{y.value=!1,x.value=!1}}async function j(){h.value=!0,await b()}function I(i){u.value=u.value.filter(e=>e.id!==i)}function P(){if(x.value||!h.value)return;const i=window.innerHeight+window.scrollY;document.documentElement.scrollHeight-i<400&&(x.value=!0,b(!0))}return(i,e)=>{const c=W("router-link");return r(),n("div",O,[t("div",Q,[t("div",X,[t("button",{onClick:e[0]||(e[0]=d=>F("all")),class:L(["flex-1 py-3 text-sm font-medium text-center transition-colors border-b-2",f.value==="all"?"text-summit-800 border-summit-800":"text-gray-500 border-transparent hover:text-gray-700"])}," For You ",2),t("button",{onClick:e[1]||(e[1]=d=>F("following")),class:L(["flex-1 py-3 text-sm font-medium text-center transition-colors border-b-2",f.value==="following"?"text-summit-800 border-summit-800":"text-gray-500 border-transparent hover:text-gray-700"])}," Following ",2)])]),!y.value&&u.value.length===0?(r(),n("div",ee,[e[4]||(e[4]=t("div",{class:"w-24 h-24 mx-auto mb-6 rounded-full bg-summit-100 flex items-center justify-center"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-12 h-12 text-summit-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"1.5"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"})])],-1)),t("h2",te,[f.value==="following"?(r(),n(w,{key:0},[p(" Follow people to see their posts ")],64)):(r(),n(w,{key:1},[p(" Welcome to CoachHub, "+z($(g).displayName)+"! ",1)],64))]),t("p",oe,[f.value==="following"?(r(),n(w,{key:0},[p(" When you follow coaches and athletes, their posts will show up here. ")],64)):(r(),n(w,{key:1},[p(" Your feed is empty. Start by following coaches and athletes, or create your first post. ")],64))]),t("div",se,[C(c,{to:"/explore",class:"btn-primary"},{default:E(()=>[...e[2]||(e[2]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1),p(" Explore ",-1)])]),_:1}),C(c,{to:"/create",class:"btn-secondary"},{default:E(()=>[...e[3]||(e[3]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4v16m8-8H4"})],-1),p(" Create Post ",-1)])]),_:1})])])):y.value?(r(),n("div",re,[(r(),n(w,null,H(3,d=>C(K,{key:d})),64))])):k.value?(r(),n("div",le,[e[5]||(e[5]=t("div",{class:"w-16 h-16 mx-auto mb-4 rounded-full bg-red-100 flex items-center justify-center"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-8 h-8 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})])],-1)),e[6]||(e[6]=t("p",{class:"text-gray-900 font-medium mb-2"},"Something went wrong",-1)),t("p",ne,z(k.value),1),t("button",{onClick:j,class:"btn-primary"}," Try Again ")])):(r(),n("div",ie,[t("div",{class:"text-center py-3 text-gray-400 text-sm"},[t("button",{onClick:j,class:"hover:text-gray-600 transition-colors"}," Pull to refresh ")]),C(G,{name:"feed",tag:"div",class:"space-y-4 px-4"},{default:E(()=>[(r(!0),n(w,null,H(u.value,d=>(r(),U(J,{key:d.id,post:d,onDeleted:I},null,8,["post"]))),128))]),_:1}),x.value?(r(),n("div",ae,[...e[7]||(e[7]=[t("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-summit-600"},null,-1)])])):!h.value&&u.value.length>0?(r(),n("div",ue," You're all caught up! ")):R("",!0)]))])}}}),_e=Z(ce,[["__scopeId","data-v-082ad5c0"]]);export{_e as default};
