import{d as U,u as X,m as Y,s as c,c as a,a as t,y as x,t as n,F as j,n as E,b as d,p as F,f as z,h as A,k as Z,r as u,q as H,o as l,l as ee}from"./index-CR_8Ibs2.js";import{_ as te}from"./ConfirmDialog.vue_vue_type_script_setup_true_lang-DVidb-Rq.js";import{_ as se}from"./Toast.vue_vue_type_script_setup_true_lang-C6u_wdkL.js";import{A as oe}from"./AssignWorkoutModal-Cq8LLJVk.js";import"./athletes-CyaJPgAV.js";import"./assignments-B69FrS5a.js";import"./streaks-sQ-aq7wy.js";import"./posts-q9q58uK3.js";const re={class:"pb-20"},ne={class:"sticky top-0 z-10 bg-white border-b border-feed-border px-4 py-3"},ae={class:"flex items-center gap-3"},le={class:"flex-1 min-w-0"},ie={class:"font-display text-lg font-bold text-gray-900 truncate"},de={class:"flex gap-1"},ue={key:0,class:"p-6"},ce={class:"animate-pulse space-y-4"},me={key:1,class:"p-4 space-y-6"},pe={class:"card p-4 space-y-3"},ge={key:0,class:"text-sm text-gray-700"},ve={class:"flex flex-wrap gap-2"},fe={class:"inline-flex items-center gap-1 text-xs font-medium px-2.5 py-1 rounded-full bg-gray-100 text-gray-600"},we={class:"inline-flex items-center gap-1 text-xs font-medium px-2.5 py-1 rounded-full bg-gray-100 text-gray-600"},xe={class:"inline-flex items-center gap-1 text-xs font-medium px-2.5 py-1 rounded-full bg-gray-100 text-gray-600"},ke={key:0,class:"text-center py-8"},he={class:"font-semibold text-gray-900 flex items-center gap-2"},ye={class:"w-7 h-7 bg-summit-100 text-summit-700 rounded-full flex items-center justify-center text-xs font-bold"},_e={class:"text-xs text-gray-500 font-normal"},be={key:0,class:"card p-4 text-center"},Ce={class:"flex items-start justify-between gap-3"},$e={class:"flex-1 min-w-0"},Me={class:"flex items-center gap-2 mb-1"},De={key:0,class:"text-xs font-medium text-summit-700 bg-summit-50 px-2 py-0.5 rounded"},Be={class:"font-semibold text-gray-900"},je={key:0,class:"text-sm text-gray-600 line-clamp-2 mt-1"},Ee={class:"flex flex-wrap gap-3 mt-2 text-xs text-gray-500"},ze={key:0,class:"inline-flex items-center gap-1"},Ae={key:1,class:"inline-flex items-center gap-1"},He={key:2,class:"inline-flex items-center gap-1 text-summit-700"},qe={class:"flex flex-col gap-1 flex-shrink-0"},Te=["onClick"],We=["onClick"],Ie={class:"flex gap-3"},Ke=U({__name:"ProgramDetailView",setup(Le){const S=ee(),v=Z(),k=X(),i=u(null),f=u([]),_=u(!0),b=u({}),h=u(!1),C=u(null),$=u(!1),M=u(!1),q=u(""),T=u("success"),D=u(!1);function B(r,e="success"){q.value=r,T.value=e,D.value=!0}const w=H(()=>S.params.id),W=H(()=>f.value.reduce((r,e)=>r+e.workouts.length,0)),I=H(()=>f.value.reduce((r,e)=>r+e.workouts.reduce((s,o)=>s+(o.exercise_count||0),0),0));Y(async()=>{await L()});async function L(){if(k.user)try{_.value=!0;const{data:r,error:e}=await c.from("programs").select("*").eq("id",w.value).eq("coach_id",k.user.id).single();if(e)throw e;i.value=r;const{data:s,error:o}=await c.from("program_weeks").select("*").eq("program_id",w.value).order("week_number");if(o)throw o;if(s&&s.length>0){const m=s.map(p=>p.id),{data:y,error:N}=await c.from("workouts").select("*, exercises(id)").in("program_week_id",m).order("day_of_week");if(N)throw N;const P=(y||[]).map(p=>p.id);if(P.length>0){const{data:p}=await c.from("workout_assignments").select("workout_id").in("workout_id",P),g={};(p||[]).forEach(V=>{g[V.workout_id]=(g[V.workout_id]||0)+1}),b.value=g}f.value=s.map(p=>({...p,workouts:(y||[]).filter(g=>g.program_week_id===p.id).map(g=>({...g,exercise_count:g.exercises?.length||0,exercises:void 0}))}))}else f.value=[]}catch(r){console.error("Error loading program:",r),B("Failed to load program","error")}finally{_.value=!1}}function R(r){C.value=r,h.value=!0}function G(){h.value=!1,C.value=null,B("Workout assigned to athlete(s)"),L()}async function J(){if(!(!k.user||!i.value)){M.value=!0;try{const{data:r}=await c.from("program_weeks").select("id").eq("program_id",i.value.id);if(r&&r.length>0){const s=r.map(m=>m.id),{data:o}=await c.from("workouts").select("id").in("program_week_id",s);if(o&&o.length>0){const m=o.map(y=>y.id);await c.from("exercises").delete().in("workout_id",m),await c.from("workouts").delete().in("id",m).eq("coach_id",k.user.id)}await c.from("program_weeks").delete().in("id",s)}const{error:e}=await c.from("programs").delete().eq("id",i.value.id).eq("coach_id",k.user.id);if(e)throw e;v.push("/programs")}catch(r){console.error("Error deleting program:",r),B("Failed to delete program","error")}finally{M.value=!1}}}function K(r){return r===null?"":["","Mon","Tue","Wed","Thu","Fri","Sat","Sun"][r]||""}function O(r){switch(r){case"strength":return"bg-blue-100 text-blue-700";case"cardio":return"bg-green-100 text-green-700";case"skills":return"bg-purple-100 text-purple-700";case"recovery":return"bg-yellow-100 text-yellow-700";default:return"bg-gray-100 text-gray-700"}}function Q(r){switch(r){case"beginner":return"bg-green-100 text-green-700";case"intermediate":return"bg-yellow-100 text-yellow-700";case"advanced":return"bg-red-100 text-red-700";default:return"bg-gray-100 text-gray-600"}}return(r,e)=>(l(),a("div",re,[t("div",ne,[t("div",ae,[t("button",{onClick:e[0]||(e[0]=s=>x(v).push("/programs")),class:"p-2 hover:bg-gray-100 rounded-lg -ml-2"},[...e[9]||(e[9]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 19l-7-7 7-7"})],-1)])]),t("div",le,[t("h1",ie,n(i.value?.name||"Program"),1)]),t("div",de,[t("button",{onClick:e[1]||(e[1]=s=>x(v).push(`/programs/${w.value}/edit`)),class:"p-2 hover:bg-gray-100 rounded-lg",title:"Edit program"},[...e[10]||(e[10]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-5 h-5 text-gray-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)])]),t("button",{onClick:e[2]||(e[2]=s=>$.value=!0),class:"p-2 hover:bg-red-50 rounded-lg",title:"Delete program"},[...e[11]||(e[11]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-5 h-5 text-gray-400 hover:text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])])])])]),_.value?(l(),a("div",ue,[t("div",ce,[e[13]||(e[13]=t("div",{class:"h-24 bg-gray-100 rounded-xl"},null,-1)),(l(),a(j,null,E(3,s=>t("div",{key:s},[...e[12]||(e[12]=[t("div",{class:"h-6 bg-gray-200 rounded w-32 mb-3"},null,-1),t("div",{class:"space-y-2"},[t("div",{class:"h-16 bg-gray-100 rounded-xl"}),t("div",{class:"h-16 bg-gray-100 rounded-xl"})],-1)])])),64))])])):i.value?(l(),a("div",me,[t("div",pe,[i.value.description?(l(),a("p",ge,n(i.value.description),1)):d("",!0),t("div",ve,[i.value.difficulty?(l(),a("span",{key:0,class:F(["inline-flex items-center gap-1 text-xs font-medium px-2.5 py-1 rounded-full capitalize",Q(i.value.difficulty)])},n(i.value.difficulty),3)):d("",!0),t("span",fe,n(i.value.duration_weeks)+" week"+n(i.value.duration_weeks!==1?"s":""),1),t("span",we,n(W.value)+" workout"+n(W.value!==1?"s":""),1),t("span",xe,n(I.value)+" exercise"+n(I.value!==1?"s":""),1)])]),f.value.length===0?(l(),a("div",ke,[e[14]||(e[14]=t("div",{class:"w-16 h-16 mx-auto mb-4 bg-summit-100 rounded-full flex items-center justify-center"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-8 h-8 text-summit-700",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})])],-1)),e[15]||(e[15]=t("p",{class:"text-gray-600 mb-4"},"No weeks set up yet",-1)),t("button",{onClick:e[3]||(e[3]=s=>x(v).push(`/programs/${w.value}/edit`)),class:"btn-primary px-6"}," Build Program ")])):d("",!0),(l(!0),a(j,null,E(f.value,s=>(l(),a("div",{key:s.id,class:"space-y-3"},[t("h3",he,[t("span",ye,n(s.week_number),1),z(" "+n(s.name||`Week ${s.week_number}`)+" ",1),t("span",_e," ("+n(s.workouts.length)+" workout"+n(s.workouts.length!==1?"s":"")+") ",1)]),s.workouts.length===0?(l(),a("div",be,[e[16]||(e[16]=t("p",{class:"text-sm text-gray-500"},"No workouts in this week",-1)),t("button",{onClick:e[4]||(e[4]=o=>x(v).push(`/programs/${w.value}/edit`)),class:"text-summit-700 text-sm font-medium mt-1 hover:underline"}," Add workouts ")])):d("",!0),(l(!0),a(j,null,E(s.workouts,o=>(l(),a("div",{key:o.id,class:"card p-4 hover:shadow-md transition-shadow"},[t("div",Ce,[t("div",$e,[t("div",Me,[o.day_of_week?(l(),a("span",De,n(K(o.day_of_week)),1)):d("",!0),o.workout_type?(l(),a("span",{key:1,class:F(["text-xs font-medium px-2 py-0.5 rounded capitalize",O(o.workout_type)])},n(o.workout_type),3)):d("",!0)]),t("h4",Be,n(o.name),1),o.description?(l(),a("p",je,n(o.description),1)):d("",!0),t("div",Ee,[o.estimated_duration_min?(l(),a("span",ze,[e[17]||(e[17]=t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-3.5 h-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),z(" "+n(o.estimated_duration_min)+" min ",1)])):d("",!0),o.exercise_count?(l(),a("span",Ae,n(o.exercise_count)+" exercise"+n(o.exercise_count!==1?"s":""),1)):d("",!0),b.value[o.id]?(l(),a("span",He,n(b.value[o.id])+" assigned ",1)):d("",!0)])]),t("div",qe,[t("button",{onClick:m=>x(v).push(`/workouts/${o.id}/edit`),class:"p-2 hover:bg-gray-100 rounded-lg transition-colors",title:"Edit workout"},[...e[18]||(e[18]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-4 h-4 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)])],8,Te),t("button",{onClick:m=>R(o.id),class:"p-2 hover:bg-summit-50 rounded-lg transition-colors",title:"Assign to athlete"},[...e[19]||(e[19]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-4 h-4 text-summit-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"})],-1)])],8,We)])])]))),128))]))),128)),t("div",Ie,[t("button",{onClick:e[5]||(e[5]=s=>x(v).push(`/programs/${w.value}/edit`)),class:"btn-primary flex-1"},[...e[20]||(e[20]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-5 h-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1),z(" Edit Program ",-1)])])])])):d("",!0),A(te,{open:$.value,title:"Delete Program?",message:`Delete "${i.value?.name}"? This will also delete all weeks and workouts. This cannot be undone.`,"confirm-text":"Delete",loading:M.value,onConfirm:J,onCancel:e[6]||(e[6]=s=>$.value=!1)},null,8,["open","message","loading"]),A(oe,{"is-open":h.value,"preselected-workout-id":C.value,onClose:e[7]||(e[7]=s=>h.value=!1),onAssigned:G},null,8,["is-open","preselected-workout-id"]),A(se,{message:q.value,type:T.value,visible:D.value,onClose:e[8]||(e[8]=s=>D.value=!1)},null,8,["message","type","visible"])]))}});export{Ke as default};
