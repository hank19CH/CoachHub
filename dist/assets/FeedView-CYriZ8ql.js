import{d as E,o as s,c as o,a as e,F as S,n as L,x as P,y as V,b as v,z as R,p as H,t as m,r as _,q as j,u as q,k as X,s as T,_ as I,m as W,A as U,B as Y,h as B,i as z,T as G,j as Z,f as N}from"./index-B256TZ31.js";import{_ as J}from"./WorkoutCard.vue_vue_type_script_setup_true_lang-Dm8I2xh9.js";const K=["src","alt"],O=["src","poster"],Q={key:2,class:"w-full h-full"},ee={key:1,class:"w-full h-full bg-gradient-to-br from-violet-700 via-purple-700 to-purple-900 flex items-center justify-center"},te={key:1,class:"absolute bottom-3 left-1/2 -translate-x-1/2 flex gap-1.5"},se=["onClick"],oe={key:2,class:"absolute top-3 right-3 px-2.5 py-1 rounded-full bg-black/50 text-white text-xs font-medium"},ne=E({__name:"MediaCarousel",props:{media:{},postType:{},workoutCardData:{}},setup(r){const u=r,i=_(0),d=j(()=>[...u.media].sort((a,t)=>a.media_type==="workout_card"?1:t.media_type==="workout_card"?-1:a.display_order-t.display_order)),h=j(()=>d.value.length>1);function f(a){i.value=a}function w(){i.value<d.value.length-1&&i.value++}function y(){i.value>0&&i.value--}let C=0,$=0;function g(a){C=a.changedTouches[0].screenX}function l(a){$=a.changedTouches[0].screenX,x()}function x(){const t=C-$;Math.abs(t)>50&&(t>0?w():y())}return(a,t)=>(s(),o("div",{class:"relative bg-gray-100 aspect-square overflow-hidden",onTouchstart:g,onTouchend:l},[e("div",{class:"flex transition-transform duration-300 ease-out h-full",style:R({transform:`translateX(-${i.value*100}%)`})},[(s(!0),o(S,null,L(d.value,n=>(s(),o("div",{key:n.id,class:"w-full h-full flex-shrink-0 relative"},[n.media_type==="image"?(s(),o("img",{key:0,src:n.url,alt:n.alt_text||"Post image",class:"w-full h-full object-cover",loading:"lazy"},null,8,K)):n.media_type==="video"?(s(),o("video",{key:1,src:n.url,poster:n.thumbnail_url||void 0,class:"w-full h-full object-cover",controls:"",playsinline:"",preload:"metadata"},null,8,O)):n.media_type==="workout_card"?(s(),o("div",Q,[r.workoutCardData?(s(),P(J,{key:0,"workout-name":r.workoutCardData.workoutName,duration:r.workoutCardData.duration,"completed-at":r.workoutCardData.completedAt,exercises:r.workoutCardData.exercises,"share-settings":r.workoutCardData.shareSettings,"overall-rpe":r.workoutCardData.overallRpe,"pb-count":r.workoutCardData.pbCount},null,8,["workout-name","duration","completed-at","exercises","share-settings","overall-rpe","pb-count"])):(s(),o("div",ee,[...t[0]||(t[0]=[V('<div class="text-center text-white p-6"><div class="w-16 h-16 mx-auto mb-4 rounded-full bg-white/20 flex items-center justify-center"><svg class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg></div><p class="font-bold text-lg">Workout Complete</p></div>',1)])]))])):v("",!0)]))),128))],4),h.value?(s(),o(S,{key:0},[i.value>0?(s(),o("button",{key:0,onClick:y,class:"absolute left-2 top-1/2 -translate-y-1/2 w-8 h-8 rounded-full bg-black/50 text-white flex items-center justify-center hover:bg-black/70 transition-colors hidden sm:flex"},[...t[1]||(t[1]=[e("svg",{class:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 19l-7-7 7-7"})],-1)])])):v("",!0),i.value<d.value.length-1?(s(),o("button",{key:1,onClick:w,class:"absolute right-2 top-1/2 -translate-y-1/2 w-8 h-8 rounded-full bg-black/50 text-white flex items-center justify-center hover:bg-black/70 transition-colors hidden sm:flex"},[...t[2]||(t[2]=[e("svg",{class:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9 5l7 7-7 7"})],-1)])])):v("",!0)],64)):v("",!0),h.value?(s(),o("div",te,[(s(!0),o(S,null,L(d.value,(n,p)=>(s(),o("button",{key:n.id,onClick:c=>f(p),class:H(["w-1.5 h-1.5 rounded-full transition-all",[p===i.value?"bg-white w-3":"bg-white/50 hover:bg-white/75"]])},null,10,se))),128))])):v("",!0),h.value?(s(),o("div",oe,m(i.value+1)+"/"+m(d.value.length),1)):v("",!0)],32))}}),re={class:"post-card animate-fade-in"},le={class:"post-header"},ae=["src","alt"],ie={key:1,class:"w-10 h-10 rounded-full bg-gradient-to-br from-summit-600 to-summit-800 flex items-center justify-center text-white font-semibold text-sm"},ue={class:"flex-1 min-w-0"},ce={class:"font-semibold text-gray-900 truncate hover:underline"},de={class:"text-sm text-gray-500 truncate"},he={class:"flex items-center gap-2 text-sm text-gray-500"},pe={key:0,class:"badge-coach"},me={class:"post-actions"},fe=["fill"],ve={class:"post-content"},we={key:0,class:"font-semibold text-sm text-gray-900 mb-1"},ke={key:1,class:"text-gray-900"},ge={class:"ml-1"},xe=E({__name:"PostCard",props:{post:{}},setup(r){const u=r,i=X(),d=q(),h=_(!1),f=_(u.post.likes_count),w=_(!1),y=j(()=>{const t=new Date,n=new Date(u.post.created_at),p=t.getTime()-n.getTime(),c=Math.floor(p/6e4),b=Math.floor(p/36e5),k=Math.floor(p/864e5);return c<1?"just now":c<60?`${c}m`:b<24?`${b}h`:k<7?`${k}d`:n.toLocaleDateString("en-US",{month:"short",day:"numeric"})}),C=j(()=>u.post.media&&u.post.media.length>0),$=j(()=>u.post.author.display_name.split(" ").map(t=>t[0]).join("").toUpperCase().slice(0,2)),g=j(()=>{const t=u.post.workout_completion;if(!t)return null;const n=t.share_settings??{show_duration:!0,show_rpe:!0,show_workout_name:!0,show_exercise_details:!0,highlight_pbs_only:!1},p=(t.exercise_results??[]).map(c=>({name:c.exercise.name,sets:c.exercise.sets,reps:c.exercise.reps,weight:c.exercise.weight_kg,duration:c.exercise.duration_seconds,distance:c.exercise.distance_meters,isPb:c.is_pb}));return{workoutName:t.assignment?.workout?.name??"Workout",duration:t.duration_minutes,completedAt:t.completed_at,exercises:p,shareSettings:n,overallRpe:t.overall_rpe,pbCount:p.filter(c=>c.isPb).length}});async function l(){if(w.value||!d.user)return;w.value=!0;const t=h.value;h.value=!t,f.value+=t?-1:1;try{t?await T.from("likes").delete().eq("user_id",d.user.id).eq("post_id",u.post.id):await T.from("likes").insert({user_id:d.user.id,post_id:u.post.id})}catch(n){h.value=t,f.value+=t?1:-1,console.error("Error toggling like:",n)}finally{w.value=!1}}function x(){i.push(`/profile/${u.post.author.username}`)}function a(){i.push(`/post/${u.post.id}`)}return(t,n)=>(s(),o("article",re,[e("header",le,[e("button",{onClick:x,class:"flex-shrink-0"},[r.post.author.avatar_url?(s(),o("img",{key:0,src:r.post.author.avatar_url,alt:r.post.author.display_name,class:"post-avatar"},null,8,ae)):(s(),o("div",ie,m($.value),1))]),e("div",ue,[e("button",{onClick:x,class:"block text-left"},[e("p",ce,m(r.post.author.display_name),1),e("p",de," @"+m(r.post.author.username),1)])]),e("div",he,[r.post.post_type==="workout"?(s(),o("span",pe," Workout ")):v("",!0),e("span",null,m(y.value),1)])]),C.value?(s(),P(ne,{key:0,media:r.post.media,"post-type":r.post.post_type,"workout-card-data":g.value},null,8,["media","post-type","workout-card-data"])):v("",!0),e("div",me,[e("button",{onClick:l,class:H(["post-action-btn",{"text-red-500":h.value}])},[(s(),o("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-6 h-6",fill:h.value?"currentColor":"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[...n[0]||(n[0]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"},null,-1)])],8,fe))],2),e("button",{onClick:a,class:"post-action-btn"},[...n[1]||(n[1]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})],-1)])]),n[2]||(n[2]=V('<button class="post-action-btn"><svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"></path></svg></button><div class="flex-1"></div><button class="post-action-btn"><svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"></path></svg></button>',3))]),e("div",ve,[f.value>0?(s(),o("p",we,m(f.value.toLocaleString())+" "+m(f.value===1?"like":"likes"),1)):v("",!0),r.post.content?(s(),o("p",ke,[e("button",{onClick:x,class:"font-semibold hover:underline"},m(r.post.author.username),1),e("span",ge,m(r.post.content),1)])):v("",!0),r.post.comments_count>0?(s(),o("button",{key:2,onClick:a,class:"text-gray-500 text-sm mt-1 hover:text-gray-700"}," View all "+m(r.post.comments_count)+" comments ",1)):v("",!0)])]))}}),_e={},ye={class:"post-card"};function be(r,u){return s(),o("article",ye,[...u[0]||(u[0]=[V('<header class="post-header"><div class="skeleton-avatar w-10 h-10"></div><div class="flex-1 space-y-2"><div class="skeleton-text w-32"></div><div class="skeleton-text w-20 h-3"></div></div></header><div class="skeleton aspect-square"></div><div class="p-3 flex gap-3"><div class="skeleton w-6 h-6 rounded"></div><div class="skeleton w-6 h-6 rounded"></div><div class="skeleton w-6 h-6 rounded"></div></div><div class="px-4 pb-4 space-y-2"><div class="skeleton-text w-24"></div><div class="skeleton-text w-full"></div><div class="skeleton-text w-3/4"></div></div>',4)])])}const Ce=I(_e,[["render",be]]),$e={class:"min-h-full"},Me={key:0,class:"p-6 text-center"},je={class:"font-display text-2xl font-bold text-gray-900 mb-2"},Se={class:"flex flex-col sm:flex-row gap-3 justify-center"},Be={key:1,class:"space-y-4 p-4"},Le={key:2,class:"p-6 text-center"},Te={class:"text-gray-600 text-sm mb-4"},De={key:3,class:"pb-4"},ze={key:0,class:"flex justify-center py-6"},Ee={key:1,class:"text-center py-8 text-gray-400 text-sm"},A=20,Pe=E({__name:"FeedView",setup(r){const u=q(),i=_([]),d=_(!0),h=_(!1),f=_(null),w=_(!0);W(async()=>{await y(),window.addEventListener("scroll",$)}),U(()=>{window.removeEventListener("scroll",$)});async function y(g=!1){try{g||(d.value=!0,f.value=null);const l=g?i.value.length:0,{data:x,error:a}=await T.from("posts").select(`
        *,
        author:profiles!author_id(*),
        media:post_media(*),
        workout_completion:workout_completions!posts_workout_completion_id_fkey(
          id,
          duration_minutes,
          overall_rpe,
          has_pb,
          completed_at,
          shared_exercise_ids,
          share_settings,
          assignment:workout_assignments!workout_completions_assignment_id_fkey(
            workout:workouts!workout_assignments_workout_id_fkey(
              id,
              name,
              description
            )
          )
        )
      `).eq("visibility","public").order("created_at",{ascending:!1}).range(l,l+A-1);if(a)throw a;const t=x||[],n=t.filter(p=>p.post_type==="workout"&&p.workout_completion);if(n.length>0){const p=n.map(b=>b.workout_completion.id),{data:c}=await T.from("exercise_results").select(`
          id,
          completion_id,
          is_pb,
          exercise:exercises!exercise_results_exercise_id_fkey(
            id,
            name,
            sets,
            reps,
            weight_kg,
            duration_seconds,
            distance_meters
          )
        `).in("completion_id",p);if(c){const b=new Map;for(const k of c){const M=b.get(k.completion_id)||[];M.push(k),b.set(k.completion_id,M)}for(const k of t)if(k.workout_completion){const M=k.workout_completion.shared_exercise_ids;let D=b.get(k.workout_completion.id)||[];M&&M.length>0&&(D=D.filter(F=>M.includes(F.exercise?.id))),k.workout_completion.exercise_results=D}}}g?i.value.push(...t):i.value=t,w.value=t.length>=A}catch(l){f.value=l instanceof Error?l.message:"Failed to load posts",console.error("Error fetching posts:",l)}finally{d.value=!1,h.value=!1}}async function C(){w.value=!0,await y()}function $(){if(h.value||!w.value)return;const g=window.innerHeight+window.scrollY;document.documentElement.scrollHeight-g<400&&(h.value=!0,y(!0))}return(g,l)=>{const x=Z("router-link");return s(),o("div",$e,[!d.value&&i.value.length===0?(s(),o("div",Me,[l[2]||(l[2]=e("div",{class:"w-24 h-24 mx-auto mb-6 rounded-full bg-summit-100 flex items-center justify-center"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-12 h-12 text-summit-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"1.5"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"})])],-1)),e("h2",je," Welcome to CoachHub, "+m(Y(u).displayName)+"! ",1),l[3]||(l[3]=e("p",{class:"text-gray-600 mb-6 max-w-sm mx-auto"}," Your feed is empty. Start by following coaches and athletes, or create your first post. ",-1)),e("div",Se,[B(x,{to:"/explore",class:"btn-primary"},{default:z(()=>[...l[0]||(l[0]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1),N(" Explore ",-1)])]),_:1}),B(x,{to:"/create",class:"btn-secondary"},{default:z(()=>[...l[1]||(l[1]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4v16m8-8H4"})],-1),N(" Create Post ",-1)])]),_:1})])])):d.value?(s(),o("div",Be,[(s(),o(S,null,L(3,a=>B(Ce,{key:a})),64))])):f.value?(s(),o("div",Le,[l[4]||(l[4]=e("div",{class:"w-16 h-16 mx-auto mb-4 rounded-full bg-red-100 flex items-center justify-center"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-8 h-8 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})])],-1)),l[5]||(l[5]=e("p",{class:"text-gray-900 font-medium mb-2"},"Something went wrong",-1)),e("p",Te,m(f.value),1),e("button",{onClick:C,class:"btn-primary"}," Try Again ")])):(s(),o("div",De,[e("div",{class:"text-center py-3 text-gray-400 text-sm"},[e("button",{onClick:C,class:"hover:text-gray-600 transition-colors"}," Pull to refresh ")]),B(G,{name:"feed",tag:"div",class:"space-y-4 px-4"},{default:z(()=>[(s(!0),o(S,null,L(i.value,a=>(s(),P(xe,{key:a.id,post:a},null,8,["post"]))),128))]),_:1}),h.value?(s(),o("div",ze,[...l[6]||(l[6]=[e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-summit-600"},null,-1)])])):!w.value&&i.value.length>0?(s(),o("div",Ee," You're all caught up! ")):v("",!0)]))])}}}),Ae=I(Pe,[["__scopeId","data-v-31d362e0"]]);export{Ae as default};
