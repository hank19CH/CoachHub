import{d as R,u as Y,m as G,s as l,c as i,a as t,f as h,w as y,v as b,b as g,F as A,n as U,y as K,t as m,g as C,E as X,r as w,q as T,k as Z,o as n}from"./index-B256TZ31.js";const ee={class:"pb-20"},te={key:0,class:"p-4"},se={class:"relative"},re={key:1,class:"p-6"},oe={class:"space-y-4"},ie={key:2,class:"p-6 text-center"},ne={key:3,class:"p-4 space-y-3"},ae={class:"flex items-start justify-between gap-3"},le=["onClick"],de={class:"font-semibold text-gray-900 mb-1"},ue={key:0,class:"text-sm text-gray-600 mb-2 line-clamp-2"},ce={class:"flex flex-wrap gap-2 text-xs text-gray-500"},pe={class:"inline-flex items-center gap-1"},me={key:0,class:"inline-flex items-center gap-1 capitalize"},we={class:"flex gap-1 flex-shrink-0"},ve=["onClick"],fe=["onClick"],ge=["onClick"],ke={key:0,class:"text-center py-8 text-gray-500"},he={class:"bg-white w-full sm:max-w-lg sm:rounded-2xl rounded-t-2xl max-h-[90vh] flex flex-col animate-slide-up"},ye={class:"flex-1 overflow-y-auto p-4 space-y-4"},xe={key:0,class:"p-3 bg-red-50 border border-red-200 rounded-xl text-red-700 text-sm"},_e={class:"p-4 border-t border-feed-border flex-shrink-0 space-y-2"},be=["disabled"],Ce={key:0,class:"flex items-center gap-2 justify-center"},Me={key:1},je=R({__name:"ProgramsView",setup(Ve){const E=Z(),d=Y(),x=w([]),M=w(!0),k=w(""),V=w(!1),o=w({name:"",description:"",duration_weeks:4,difficulty:"",sport_id:null}),_=w(!1),v=w(""),z=T(()=>{if(!k.value)return x.value;const s=k.value.toLowerCase();return x.value.filter(e=>e.name.toLowerCase().includes(s)||e.description&&e.description.toLowerCase().includes(s))}),q=T(()=>x.value.length>0);G(async()=>{await B()});async function B(){if(d.user)try{M.value=!0;const{data:s,error:e}=await l.from("programs").select("*").eq("coach_id",d.user.id).order("created_at",{ascending:!1});if(e)throw e;x.value=s||[]}catch(s){console.error("Error loading programs:",s?.message||s?.code||JSON.stringify(s))}finally{M.value=!1}}function N(){o.value={name:"",description:"",duration_weeks:4,difficulty:"",sport_id:null},v.value="",V.value=!0}function j(){V.value=!1,v.value=""}async function I(){if(!(!d.user||!o.value.name))try{_.value=!0,v.value="";const{data:s,error:e}=await l.from("programs").insert({coach_id:d.user.id,name:o.value.name,description:o.value.description||null,duration_weeks:o.value.duration_weeks,difficulty:o.value.difficulty||null,sport_id:o.value.sport_id,is_template:!0,is_published:!1}).select().single();if(e)throw e;E.push(`/programs/${s.id}/edit`)}catch(s){console.error("Error creating program:",s?.message||s?.code||JSON.stringify(s)),v.value=s?.message||(s instanceof Error?s.message:"Failed to create program")}finally{_.value=!1}}function S(s){E.push(`/programs/${s}/edit`)}async function W(s){if(d.user&&confirm(`Delete "${s.name}"? This will also delete all weeks and workouts in this program. This cannot be undone.`))try{const{data:e}=await l.from("program_weeks").select("id").eq("program_id",s.id);if(e&&e.length>0){const u=e.map(c=>c.id),{data:f}=await l.from("workouts").select("id").in("program_week_id",u);if(f&&f.length>0){const c=f.map(P=>P.id);await l.from("exercises").delete().in("workout_id",c),await l.from("workouts").delete().in("id",c).eq("coach_id",d.user.id)}await l.from("program_weeks").delete().in("id",u)}const{error:r}=await l.from("programs").delete().eq("id",s.id).eq("coach_id",d.user.id);if(r)throw r;await B()}catch(e){console.error("Error deleting program:",e),alert("Failed to delete program")}}async function J(s){if(d.user)try{const{data:e,error:r}=await l.from("programs").insert({coach_id:d.user.id,name:`${s.name} (Copy)`,description:s.description,duration_weeks:s.duration_weeks,difficulty:s.difficulty,sport_id:s.sport_id,is_template:s.is_template,is_published:!1}).select().single();if(r)throw r;const{data:u,error:f}=await l.from("program_weeks").select("*").eq("program_id",s.id).order("week_number");if(f)throw f;if(u&&u.length>0)for(const c of u){const{data:P,error:D}=await l.from("program_weeks").insert({program_id:e.id,week_number:c.week_number,name:c.name,notes:c.notes}).select().single();if(D)throw D;const{data:H,error:L}=await l.from("workouts").select("*, exercises(*)").eq("program_week_id",c.id);if(L)throw L;if(H)for(const p of H){const{data:O,error:$}=await l.from("workouts").insert({coach_id:d.user.id,program_week_id:P.id,name:p.name,description:p.description,day_of_week:p.day_of_week,estimated_duration_min:p.estimated_duration_min,workout_type:p.workout_type,is_template:p.is_template}).select().single();if($)throw $;if(p.exercises&&p.exercises.length>0){const Q=p.exercises.map(a=>({workout_id:O.id,name:a.name,description:a.description,order_index:a.order_index,sets:a.sets,reps:a.reps,weight_kg:a.weight_kg,duration_seconds:a.duration_seconds,distance_meters:a.distance_meters,rpe:a.rpe,intensity_percent:a.intensity_percent,target_time_seconds:a.target_time_seconds,rest_seconds:a.rest_seconds,notes:a.notes,video_url:a.video_url})),{error:F}=await l.from("exercises").insert(Q);if(F)throw F}}}await B(),alert(`Program duplicated! "${e.name}" has been created.`)}catch(e){console.error("Error duplicating program:",e),alert("Failed to duplicate program")}}return(s,e)=>(n(),i("div",ee,[t("div",{class:"sticky top-0 z-10 bg-white border-b border-feed-border px-4 py-3"},[t("div",{class:"flex items-center justify-between"},[e[6]||(e[6]=t("h1",{class:"font-display text-xl font-bold text-gray-900"},"Programs",-1)),t("button",{onClick:N,class:"btn-primary px-4 py-2 text-sm"},[...e[5]||(e[5]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-4 h-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4v16m8-8H4"})],-1),h(" New Program ",-1)])])])]),q.value?(n(),i("div",te,[t("div",se,[y(t("input",{"onUpdate:modelValue":e[0]||(e[0]=r=>k.value=r),type:"text",placeholder:"Search programs...",class:"input pl-10"},null,512),[[b,k.value]]),e[7]||(e[7]=t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-5 h-5 text-gray-400 absolute left-3 top-1/2 -translate-y-1/2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1))])])):g("",!0),M.value?(n(),i("div",re,[t("div",oe,[(n(),i(A,null,U(3,r=>t("div",{key:r,class:"animate-pulse"},[...e[8]||(e[8]=[t("div",{class:"p-4 bg-gray-50 rounded-xl"},[t("div",{class:"h-5 bg-gray-200 rounded w-3/4 mb-2"}),t("div",{class:"h-4 bg-gray-200 rounded w-1/2"})],-1)])])),64))])])):q.value?(n(),i("div",ne,[(n(!0),i(A,null,U(z.value,r=>(n(),i("div",{key:r.id,class:"card p-4 hover:shadow-md transition-shadow"},[t("div",ae,[t("div",{onClick:u=>S(r.id),class:"flex-1 min-w-0 cursor-pointer"},[t("h3",de,m(r.name),1),r.description?(n(),i("p",ue,m(r.description),1)):g("",!0),t("div",ce,[t("span",pe,[e[11]||(e[11]=t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)),h(" "+m(r.duration_weeks)+" week"+m(r.duration_weeks!==1?"s":""),1)]),r.difficulty?(n(),i("span",me,[e[12]||(e[12]=t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M13 10V3L4 14h7v7l9-11h-7z"})],-1)),h(" "+m(r.difficulty),1)])):g("",!0)])],8,le),t("div",we,[t("button",{onClick:C(u=>S(r.id),["stop"]),class:"p-2 hover:bg-gray-100 rounded-lg transition-colors",title:"Edit program"},[...e[13]||(e[13]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-5 h-5 text-gray-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)])],8,ve),t("button",{onClick:C(u=>J(r),["stop"]),class:"p-2 hover:bg-gray-100 rounded-lg transition-colors",title:"Duplicate program"},[...e[14]||(e[14]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-5 h-5 text-gray-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})],-1)])],8,fe),t("button",{onClick:C(u=>W(r),["stop"]),class:"p-2 hover:bg-red-50 rounded-lg transition-colors",title:"Delete program"},[...e[15]||(e[15]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-5 h-5 text-gray-400 hover:text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,ge)])])]))),128)),z.value.length===0?(n(),i("div",ke,[t("p",null,'No programs found matching "'+m(k.value)+'"',1)])):g("",!0)])):(n(),i("div",ie,[t("div",{class:"max-w-sm mx-auto"},[e[10]||(e[10]=K('<div class="w-20 h-20 mx-auto mb-4 bg-summit-100 rounded-full flex items-center justify-center"><svg xmlns="http://www.w3.org/2000/svg" class="w-10 h-10 text-summit-700" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg></div><h2 class="font-semibold text-lg text-gray-900 mb-2">No programs yet</h2><p class="text-gray-600 mb-6"> Create your first training program with multiple weeks and structured workouts </p>',3)),t("button",{onClick:N,class:"btn-primary w-full"},[...e[9]||(e[9]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-5 h-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4v16m8-8H4"})],-1),h(" Create Your First Program ",-1)])])])])),V.value?(n(),i("div",{key:4,class:"fixed inset-0 z-50 flex items-end sm:items-center justify-center bg-black bg-opacity-50",onClick:C(j,["self"])},[t("div",he,[t("div",{class:"p-4 border-b border-feed-border flex items-center justify-between flex-shrink-0"},[e[17]||(e[17]=t("h2",{class:"font-semibold text-lg"},"Create Program",-1)),t("button",{onClick:j,class:"w-8 h-8 rounded-full hover:bg-gray-100 flex items-center justify-center"},[...e[16]||(e[16]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),t("div",ye,[v.value?(n(),i("div",xe,m(v.value),1)):g("",!0),t("div",null,[e[18]||(e[18]=t("label",{class:"label"},"Program Name *",-1)),y(t("input",{"onUpdate:modelValue":e[1]||(e[1]=r=>o.value.name=r),type:"text",placeholder:"e.g., 4-Week Speed Development Block",class:"input",required:""},null,512),[[b,o.value.name]])]),t("div",null,[e[19]||(e[19]=t("label",{class:"label"},"Description",-1)),y(t("textarea",{"onUpdate:modelValue":e[2]||(e[2]=r=>o.value.description=r),rows:"3",placeholder:"Brief overview of the program...",class:"input resize-none"},null,512),[[b,o.value.description]])]),t("div",null,[e[20]||(e[20]=t("label",{class:"label"},"Duration (weeks) *",-1)),y(t("input",{"onUpdate:modelValue":e[3]||(e[3]=r=>o.value.duration_weeks=r),type:"number",min:"1",max:"52",class:"input",required:""},null,512),[[b,o.value.duration_weeks,void 0,{number:!0}]])]),t("div",null,[e[22]||(e[22]=t("label",{class:"label"},"Difficulty Level",-1)),y(t("select",{"onUpdate:modelValue":e[4]||(e[4]=r=>o.value.difficulty=r),class:"input"},[...e[21]||(e[21]=[t("option",{value:""},"Select level...",-1),t("option",{value:"beginner"},"Beginner",-1),t("option",{value:"intermediate"},"Intermediate",-1),t("option",{value:"advanced"},"Advanced",-1)])],512),[[X,o.value.difficulty]])]),e[23]||(e[23]=t("div",{class:"p-3 bg-summit-50 border border-summit-200 rounded-xl text-sm text-summit-800"},[t("p",{class:"font-medium mb-1"},"ðŸ’¡ Next Step"),t("p",null,"After creating the program, you'll build out each week and assign workouts to specific days.")],-1))]),t("div",_e,[t("button",{onClick:I,disabled:!o.value.name||_.value,class:"btn-primary w-full"},[_.value?(n(),i("span",Ce,[...e[24]||(e[24]=[t("svg",{class:"animate-spin h-4 w-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),h(" Creating... ",-1)])])):(n(),i("span",Me,"Create & Build Program"))],8,be),t("button",{onClick:j,class:"btn-secondary w-full"}," Cancel ")])])])):g("",!0)]))}});export{je as default};
