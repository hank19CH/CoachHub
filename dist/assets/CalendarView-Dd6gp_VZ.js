import{d as q,u as U,r as d,m as G,c as r,a as s,f as V,t as u,b as C,F as x,n as b,A as J,h as $,q as D,o as a,p as k}from"./index-CR_8Ibs2.js";import{a as K}from"./assignments-B69FrS5a.js";import{A as P}from"./AssignWorkoutModal-Cq8LLJVk.js";import{_ as Q}from"./Toast.vue_vue_type_script_setup_true_lang-C6u_wdkL.js";import{a as v}from"./addDays-BsqNNgc4.js";import{t as X,n as Y,d as E,s as L,f as m}from"./format-HA5A4YDt.js";import"./streaks-sQ-aq7wy.js";import"./posts-q9q58uK3.js";import"./athletes-CyaJPgAV.js";function Z(h,y){const c=X(h,y?.in).getDay();return c===0||c===6}function ee(h,y,c){const[p,n]=Y(c?.in,h,y);return+E(p)==+E(n)}const te={class:"pb-20"},se={class:"sticky top-0 z-10 bg-white border-b border-feed-border px-4 py-3"},oe={class:"flex items-center justify-between mb-3"},re={class:"flex items-center justify-between"},ae={class:"text-center"},ne={class:"font-semibold text-gray-900"},le={key:0,class:"p-6 text-center"},ie={key:1,class:"overflow-x-auto"},de={class:"grid grid-cols-8 border-b border-gray-200 bg-gray-50 min-w-[700px]"},ue={class:"text-xs font-medium text-gray-500 uppercase"},ce={class:"px-3 py-3 border-r border-gray-200 flex items-center gap-2"},me={key:0,class:"w-8 h-8 rounded-full overflow-hidden flex-shrink-0"},ye=["src","alt"],pe={key:1,class:"w-8 h-8 rounded-full bg-summit-600 text-white flex items-center justify-center text-xs font-semibold flex-shrink-0"},ge={class:"min-w-0"},ve={class:"text-sm font-medium text-gray-900 truncate"},he={class:"text-xs text-gray-500"},fe=["title"],xe={key:0,class:"mr-0.5"},be=["onClick"],ke={key:0,class:"text-center py-16 px-4"},We=q({__name:"CalendarView",setup(h){const y=U(),c=d([]),p=d(!0),n=d(L(new Date,{weekStartsOn:1})),f=d(!1),w=d(null),S=d(""),B=d("success"),_=d(!1);function T(o,e="success"){S.value=o,B.value=e,_.value=!0}const M=D(()=>{const o=[];for(let e=0;e<7;e++){const t=v(n.value,e);o.push({date:t,dateString:m(t,"yyyy-MM-dd"),dayName:m(t,"EEE"),dayNum:m(t,"d"),isToday:ee(t,new Date),isWeekend:Z(t)})}return o}),z=D(()=>{const o=m(n.value,"MMM d"),e=m(v(n.value,6),"MMM d, yyyy");return`${o} - ${e}`}),W=D(()=>{const o=new Map;return c.value.forEach(e=>{const t=Array.isArray(e.athlete)?e.athlete[0]:e.athlete;if(!t)return;o.has(t.id)||o.set(t.id,{athlete:t,assignmentsByDate:new Map,weeklyLoad:0});const i=o.get(t.id),l=e.assigned_date;i.assignmentsByDate.has(l)||i.assignmentsByDate.set(l,[]);const N=Array.isArray(e.workout)?e.workout[0]:e.workout;i.assignmentsByDate.get(l).push({...e,workout:N}),i.weeklyLoad+=N?.estimated_duration_min||0}),Array.from(o.values()).sort((e,t)=>e.athlete.display_name.localeCompare(t.athlete.display_name))});async function g(){if(y.user){p.value=!0;try{const o=m(n.value,"yyyy-MM-dd"),e=m(v(n.value,6),"yyyy-MM-dd"),t=await K.getAssignmentsByDateRange(y.user.id,o,e);c.value=t}catch(o){console.error("Error loading calendar:",o),T("Failed to load calendar","error")}finally{p.value=!1}}}function O(){n.value=v(n.value,-7),g()}function R(){n.value=v(n.value,7),g()}function F(){n.value=L(new Date,{weekStartsOn:1}),g()}function A(o){w.value=o||null,f.value=!0}function H(){f.value=!1,w.value=null,T("Workout assigned"),g()}function I(o){switch(o){case"completed":return"bg-green-100 text-green-700 border-green-200";case"skipped":return"bg-gray-100 text-gray-500 border-gray-200";default:return"bg-summit-50 text-summit-700 border-summit-200"}}function j(o){switch(o){case"completed":return"✓";case"skipped":return"—";default:return""}}return G(()=>{g()}),(o,e)=>(a(),r("div",te,[s("div",se,[s("div",oe,[e[5]||(e[5]=s("h1",{class:"font-display text-xl font-bold text-gray-900"},"Calendar",-1)),s("button",{onClick:e[0]||(e[0]=t=>A()),class:"btn-primary px-4 py-2 text-sm"},[...e[4]||(e[4]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-4 h-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4v16m8-8H4"})],-1),V(" Assign ",-1)])])]),s("div",re,[s("button",{onClick:O,class:"p-2 hover:bg-gray-100 rounded-lg"},[...e[6]||(e[6]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 19l-7-7 7-7"})],-1)])]),s("div",ae,[s("span",ne,u(z.value),1),M.value.some(t=>t.isToday)?C("",!0):(a(),r("button",{key:0,onClick:F,class:"ml-2 text-xs text-summit-700 hover:underline"}," Today "))]),s("button",{onClick:R,class:"p-2 hover:bg-gray-100 rounded-lg"},[...e[7]||(e[7]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9 5l7 7-7 7"})],-1)])])])]),p.value?(a(),r("div",le,[...e[8]||(e[8]=[s("div",{class:"animate-spin h-8 w-8 border-4 border-summit-800 border-t-transparent rounded-full mx-auto"},null,-1),s("p",{class:"mt-3 text-gray-600 text-sm"},"Loading calendar...",-1)])])):(a(),r("div",ie,[s("div",de,[e[9]||(e[9]=s("div",{class:"px-3 py-2 text-xs font-semibold text-gray-500 border-r border-gray-200"}," Athlete ",-1)),(a(!0),r(x,null,b(M.value,t=>(a(),r("div",{key:t.dateString,class:k(["px-2 py-2 text-center border-r border-gray-200 last:border-r-0",{"bg-summit-50":t.isToday}])},[s("div",ue,u(t.dayName),1),s("div",{class:k(["text-sm font-bold",t.isToday?"text-summit-700":"text-gray-900"])},u(t.dayNum),3)],2))),128))]),(a(!0),r(x,null,b(W.value,t=>(a(),r("div",{key:t.athlete.id,class:"grid grid-cols-8 border-b border-gray-100 min-w-[700px] hover:bg-gray-50/50"},[s("div",ce,[t.athlete.avatar_url?(a(),r("div",me,[s("img",{src:t.athlete.avatar_url,alt:t.athlete.display_name,class:"w-full h-full object-cover"},null,8,ye)])):(a(),r("div",pe,u(t.athlete.display_name.charAt(0).toUpperCase()),1)),s("div",ge,[s("div",ve,u(t.athlete.display_name),1),s("div",he,u(t.weeklyLoad)+"m/wk",1)])]),(a(!0),r(x,null,b(M.value,i=>(a(),r("div",{key:i.dateString,class:k(["px-1 py-2 border-r border-gray-200 last:border-r-0 min-h-[80px] relative group",{"bg-summit-50/50":i.isToday}])},[(a(!0),r(x,null,b(t.assignmentsByDate.get(i.dateString)||[],l=>(a(),r("div",{key:l.id,class:k(["text-xs rounded px-1.5 py-1 mb-1 border truncate cursor-default",I(l.status)]),title:`${l.workout?.name||"Workout"} - ${l.status}`},[j(l.status)?(a(),r("span",xe,u(j(l.status)),1)):C("",!0),V(" "+u(l.workout?.name||"Workout"),1)],10,fe))),128)),s("button",{onClick:l=>A(t.athlete.id),class:"absolute bottom-1 right-1 w-5 h-5 bg-summit-600 text-white rounded-full opacity-0 group-hover:opacity-60 hover:!opacity-100 transition-opacity flex items-center justify-center text-xs"}," + ",8,be)],2))),128))]))),128)),W.value.length===0?(a(),r("div",ke,[e[10]||(e[10]=J('<div class="w-16 h-16 mx-auto mb-4 bg-summit-100 rounded-full flex items-center justify-center"><svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8 text-summit-700" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg></div><h3 class="font-semibold text-gray-900 mb-2">No assignments this week</h3><p class="text-sm text-gray-600 mb-4">Assign workouts to athletes to see them on the calendar</p>',3)),s("button",{onClick:e[1]||(e[1]=t=>A()),class:"btn-primary px-6"}," Assign a Workout ")])):C("",!0)])),$(P,{"is-open":f.value,"preselected-athlete-id":w.value,onClose:e[2]||(e[2]=t=>f.value=!1),onAssigned:H},null,8,["is-open","preselected-athlete-id"]),$(Q,{message:S.value,type:B.value,visible:_.value,onClose:e[3]||(e[3]=t=>_.value=!1)},null,8,["message","type","visible"])]))}});export{We as default};
