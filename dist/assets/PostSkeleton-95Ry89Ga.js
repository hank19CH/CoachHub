import{d as E,u as F,r as k,m as U,s as _,o,c as l,F as W,a as t,t as r,p as P,b as c,f as z,g as S,z as $,A as B,D as H,k as I,q as m,_ as O}from"./index-CR_8Ibs2.js";import{_ as G,d as J}from"./MediaCarousel.vue_vue_type_script_setup_true_lang-BlmED56j.js";const K={class:"post-card animate-fade-in"},Q={class:"post-header"},X=["src","alt"],Y={key:1,class:"w-10 h-10 rounded-full bg-gradient-to-br from-summit-600 to-summit-800 flex items-center justify-center text-white font-semibold text-sm"},Z={class:"flex-1 min-w-0"},ee={class:"font-semibold text-gray-900 truncate hover:underline"},te={class:"text-sm text-gray-500 truncate"},se={class:"flex items-center gap-2 text-sm text-gray-500"},oe={key:0,class:"mr-0.5"},ae={key:1,class:"mr-0.5"},ne={class:"post-actions"},le=["fill"],ie={class:"post-content"},re={key:0,class:"font-semibold text-sm text-gray-900 mb-1"},de={key:1,class:"text-gray-900"},ce={class:"ml-1"},ue={class:"bg-white rounded-2xl p-6 max-w-sm w-full shadow-xl"},pe={class:"flex gap-3"},me=["disabled"],ve=["disabled"],he={key:0,class:"flex items-center gap-2"},fe={key:1},_e=E({__name:"PostCard",props:{post:{}},emits:["deleted"],setup(a,{emit:w}){const n=a,y=I(),u=F(),p=k(!1),v=k(n.post.likes_count),g=k(!1);U(async()=>{if(u.user)try{const{data:s}=await _.from("likes").select("id").eq("user_id",u.user.id).eq("post_id",n.post.id).maybeSingle();p.value=!!s}catch{}});const x=m(()=>{switch(n.post.post_type){case"workout":return{label:"Workout",class:"bg-summit-100 text-summit-800"};case"pr":return{label:"PR",class:"bg-amber-100 text-amber-800"};case"streak_milestone":return{label:"Streak",class:"bg-valencia-100 text-valencia-800"};case"achievement":return{label:"Achievement",class:"bg-green-100 text-green-800"};default:return null}}),L=m(()=>{const s=new Date,e=new Date(n.post.created_at),d=s.getTime()-e.getTime(),i=Math.floor(d/6e4),M=Math.floor(d/36e5),D=Math.floor(d/864e5);return i<1?"just now":i<60?`${i}m`:M<24?`${M}h`:D<7?`${D}d`:e.toLocaleDateString("en-US",{month:"short",day:"numeric"})}),j=m(()=>n.post.media&&n.post.media.length>0),T=m(()=>n.post.author.display_name.split(" ").map(s=>s[0]).join("").toUpperCase().slice(0,2)),q=m(()=>{const s=n.post.workout_completion;if(!s)return null;const e=s.share_settings??{show_duration:!0,show_rpe:!0,show_workout_name:!0,show_exercise_details:!0,highlight_pbs_only:!1},d=(s.exercise_results??[]).map(i=>({name:i.exercise.name,sets:i.exercise.sets,reps:i.exercise.reps,weight:i.exercise.weight_kg,duration:i.exercise.duration_seconds,distance:i.exercise.distance_meters,isPb:i.is_pb}));return{workoutName:s.assignment?.workout?.name??"Workout",duration:s.duration_minutes,completedAt:s.completed_at,exercises:d,shareSettings:e,overallRpe:s.overall_rpe,pbCount:d.filter(i=>i.isPb).length}});async function A(){if(g.value||!u.user)return;g.value=!0;const s=p.value;p.value=!s,v.value+=s?-1:1;try{s?await _.from("likes").delete().eq("user_id",u.user.id).eq("post_id",n.post.id):await _.from("likes").insert({user_id:u.user.id,post_id:n.post.id})}catch(e){p.value=s,v.value+=s?1:-1,console.error("Error toggling like:",e)}finally{g.value=!1}}const h=k(!1),f=k(!1),V=m(()=>u.user?.id===n.post.author_id),N=w;async function R(){if(!u.user)return;f.value=!0,await J(n.post.id,u.user.id)&&(h.value=!1,N("deleted",n.post.id)),f.value=!1}function b(){y.push(`/profile/${n.post.author.username}`)}function C(){y.push(`/post/${n.post.id}`)}return(s,e)=>(o(),l(W,null,[t("article",K,[t("header",Q,[t("button",{onClick:b,class:"flex-shrink-0"},[a.post.author.avatar_url?(o(),l("img",{key:0,src:a.post.author.avatar_url,alt:a.post.author.display_name,class:"post-avatar"},null,8,X)):(o(),l("div",Y,r(T.value),1))]),t("div",Z,[t("button",{onClick:b,class:"block text-left"},[t("p",ee,r(a.post.author.display_name),1),t("p",te," @"+r(a.post.author.username),1)])]),t("div",se,[x.value?(o(),l("span",{key:0,class:P(["inline-flex items-center px-2 py-0.5 rounded-full text-xs font-semibold",x.value.class])},[a.post.post_type==="pr"?(o(),l("span",oe,"â˜…")):c("",!0),a.post.post_type==="streak_milestone"?(o(),l("span",ae,"ðŸ”¥")):c("",!0),z(" "+r(x.value.label),1)],2)):c("",!0),t("span",null,r(L.value),1),V.value?(o(),l("button",{key:1,onClick:e[0]||(e[0]=S(d=>h.value=!0,["stop"])),class:"ml-1 p-1 text-gray-400 hover:text-red-500 transition-colors",title:"Delete post"},[...e[3]||(e[3]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"})],-1)])])):c("",!0)])]),j.value?(o(),$(G,{key:0,media:a.post.media,"post-type":a.post.post_type,"workout-card-data":q.value},null,8,["media","post-type","workout-card-data"])):c("",!0),t("div",ne,[t("button",{onClick:A,class:P(["post-action-btn",{"text-red-500":p.value}])},[(o(),l("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-6 h-6",fill:p.value?"currentColor":"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[...e[4]||(e[4]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"},null,-1)])],8,le))],2),t("button",{onClick:C,class:"post-action-btn"},[...e[5]||(e[5]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})],-1)])]),e[6]||(e[6]=B('<button class="post-action-btn"><svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"></path></svg></button><div class="flex-1"></div><button class="post-action-btn"><svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"></path></svg></button>',3))]),t("div",ie,[v.value>0?(o(),l("p",re,r(v.value.toLocaleString())+" "+r(v.value===1?"like":"likes"),1)):c("",!0),a.post.content?(o(),l("p",de,[t("button",{onClick:b,class:"font-semibold hover:underline"},r(a.post.author.username),1),t("span",ce,r(a.post.content),1)])):c("",!0),a.post.comments_count>0?(o(),l("button",{key:2,onClick:C,class:"text-gray-500 text-sm mt-1 hover:text-gray-700"}," View all "+r(a.post.comments_count)+" comments ",1)):c("",!0)])]),(o(),$(H,{to:"body"},[h.value?(o(),l("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50",onClick:e[2]||(e[2]=S(d=>h.value=!1,["self"]))},[t("div",ue,[e[8]||(e[8]=t("h3",{class:"text-lg font-semibold text-gray-900 mb-2"},"Delete Post?",-1)),e[9]||(e[9]=t("p",{class:"text-sm text-gray-600 mb-6"}," Are you sure you want to delete this post? This action cannot be undone. ",-1)),t("div",pe,[t("button",{onClick:e[1]||(e[1]=d=>h.value=!1),class:"flex-1 btn-secondary",disabled:f.value}," Cancel ",8,me),t("button",{onClick:R,class:"flex-1 btn bg-red-600 text-white hover:bg-red-700 focus:ring-red-500",disabled:f.value},[f.value?(o(),l("span",he,[...e[7]||(e[7]=[t("div",{class:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"},null,-1),z(" Deleting... ",-1)])])):(o(),l("span",fe,"Delete"))],8,ve)])])])):c("",!0)]))],64))}}),ke={},we={class:"post-card"};function ge(a,w){return o(),l("article",we,[...w[0]||(w[0]=[B('<header class="post-header"><div class="skeleton-avatar w-10 h-10"></div><div class="flex-1 space-y-2"><div class="skeleton-text w-32"></div><div class="skeleton-text w-20 h-3"></div></div></header><div class="skeleton aspect-square"></div><div class="p-3 flex gap-3"><div class="skeleton w-6 h-6 rounded"></div><div class="skeleton w-6 h-6 rounded"></div><div class="skeleton w-6 h-6 rounded"></div></div><div class="px-4 pb-4 space-y-2"><div class="skeleton-text w-24"></div><div class="skeleton-text w-full"></div><div class="skeleton-text w-3/4"></div></div>',4)])])}const ye=O(ke,[["render",ge]]);export{ye as P,_e as _};
