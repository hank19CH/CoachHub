import{d as P,u as B,c as n,a as e,F as z,n as ee,o as a,t as d,y as w,b,k as I,g as R,w as te,v as se,r as x,m as oe,s as j,A as ae,p as U,z as V,f as q,h as N,G as ne,q as $,l as le}from"./index-DoIKaNgo.js";import{a as re,b as ie,_ as ue,d as de,c as ce,e as me}from"./MediaCarousel.vue_vue_type_script_setup_true_lang-cAo-VpB0.js";import"./WorkoutCard.vue_vue_type_script_setup_true_lang-Cnp1jYFM.js";const ve={class:"space-y-1"},fe={key:0,class:"px-4 py-6 text-center"},pe={key:1,class:"px-4 py-6 text-center text-sm text-gray-400"},he=["onClick"],ge=["src","alt"],_e={key:1,class:"w-8 h-8 rounded-full bg-gradient-to-br from-summit-600 to-summit-800 flex items-center justify-center text-white font-semibold text-xs"},xe={class:"flex-1 min-w-0"},ye={class:"text-sm"},be=["onClick"],we={class:"ml-1 text-gray-700"},ke={class:"flex items-center gap-3 mt-1 text-xs text-gray-400"},Ce=["onClick"],$e=P({__name:"CommentsList",props:{comments:{},loading:{type:Boolean}},emits:["delete"],setup(k,{emit:D}){const y=D,i=B(),s=I();function _(v){const c=new Date,r=new Date(v),f=c.getTime()-r.getTime(),h=Math.floor(f/6e4),M=Math.floor(f/36e5),g=Math.floor(f/864e5);return h<1?"just now":h<60?`${h}m`:M<24?`${M}h`:g<7?`${g}d`:r.toLocaleDateString("en-US",{month:"short",day:"numeric"})}function C(v){return v.split(" ").map(c=>c[0]).join("").toUpperCase().slice(0,2)}function p(v){s.push(`/profile/${v}`)}return(v,c)=>(a(),n("div",ve,[k.loading?(a(),n("div",fe,[...c[0]||(c[0]=[e("div",{class:"animate-spin rounded-full h-6 w-6 border-b-2 border-summit-600 mx-auto"},null,-1)])])):k.comments.length===0?(a(),n("div",pe," No comments yet. Be the first to comment! ")):(a(!0),n(z,{key:2},ee(k.comments,r=>(a(),n("div",{key:r.id,class:"flex items-start gap-3 px-4 py-2.5"},[e("button",{onClick:f=>p(r.author.username),class:"flex-shrink-0"},[r.author.avatar_url?(a(),n("img",{key:0,src:r.author.avatar_url,alt:r.author.display_name,class:"w-8 h-8 rounded-full object-cover"},null,8,ge)):(a(),n("div",_e,d(C(r.author.display_name)),1))],8,he),e("div",xe,[e("p",ye,[e("button",{onClick:f=>p(r.author.username),class:"font-semibold text-gray-900 hover:underline"},d(r.author.username),9,be),e("span",we,d(r.content),1)]),e("div",ke,[e("span",null,d(_(r.created_at)),1),r.author_id===w(i).user?.id?(a(),n("button",{key:0,onClick:f=>y("delete",r.id),class:"text-red-400 hover:text-red-600 transition-colors"}," Delete ",8,Ce)):b("",!0)])])]))),128))]))}}),Me={class:"flex items-start gap-3 px-4 py-3 border-t border-gray-100"},Ae=["src"],De={key:1,class:"w-8 h-8 rounded-full bg-gradient-to-br from-summit-600 to-summit-800 flex items-center justify-center text-white font-semibold text-xs flex-shrink-0"},Se=["disabled"],je=["disabled"],Le=P({__name:"CommentInput",props:{postId:{},loading:{type:Boolean}},emits:["submit"],setup(k,{emit:D}){const y=D,i=B(),s=x("");function _(){const p=s.value.trim();p&&(y("submit",p),s.value="")}const C=i.profile?.display_name?.split(" ").map(p=>p[0]).join("").toUpperCase().slice(0,2)??"?";return(p,v)=>(a(),n("div",Me,[w(i).avatarUrl?(a(),n("img",{key:0,src:w(i).avatarUrl,class:"w-8 h-8 rounded-full object-cover flex-shrink-0",alt:"You"},null,8,Ae)):(a(),n("div",De,d(w(C)),1)),e("form",{onSubmit:R(_,["prevent"]),class:"flex-1 flex items-center gap-2"},[te(e("input",{"onUpdate:modelValue":v[0]||(v[0]=c=>s.value=c),type:"text",placeholder:"Add a comment...",class:"flex-1 bg-transparent text-sm text-gray-900 placeholder-gray-400 outline-none",disabled:k.loading,maxlength:"500"},null,8,Se),[[se,s.value]]),e("button",{type:"submit",class:"text-sm font-semibold text-summit-700 hover:text-summit-800 disabled:opacity-40 disabled:cursor-not-allowed transition-colors",disabled:!s.value.trim()||k.loading}," Post ",8,je)],32)]))}}),Pe={key:0,class:"p-6"},Be={key:1,class:"pb-20"},Te={class:"sticky top-0 bg-white/90 backdrop-blur-sm z-10 border-b border-gray-100"},Ue={class:"flex items-center justify-between p-4"},Ve={class:"w-8"},qe={class:"post-header"},Ne=["src","alt"],ze={key:1,class:"w-10 h-10 rounded-full bg-gradient-to-br from-summit-600 to-summit-800 flex items-center justify-center text-white font-semibold text-sm"},Ie={class:"flex-1 min-w-0"},Re={class:"font-semibold text-gray-900 truncate hover:underline"},He={class:"text-sm text-gray-500 truncate"},Fe={class:"flex items-center gap-2 text-sm text-gray-500"},We={class:"post-actions"},Ee=["fill"],Ge={class:"post-content"},Oe={key:0,class:"font-semibold text-sm text-gray-900 mb-1"},Ye={key:1,class:"text-gray-900"},Je={class:"ml-1"},Ke={class:"border-t border-gray-100"},Qe={class:"px-4 py-3"},Xe={class:"font-semibold text-sm text-gray-900"},Ze={key:0,class:"text-gray-400 font-normal"},et={class:"bg-white rounded-2xl p-6 max-w-sm w-full shadow-xl"},tt={class:"flex gap-3"},st=["disabled"],ot=["disabled"],at={key:0,class:"flex items-center gap-2"},nt={key:1},ut=P({__name:"PostDetailView",setup(k){const D=le(),y=I(),i=B(),s=x(null),_=x([]),C=x(!0),p=x(!0),v=x(!1),c=x(!1),r=x(!1),f=x(!1),h=x(0),M=x(!1),g=$(()=>D.params.id),H=$(()=>s.value&&i.user&&s.value.author_id===i.user.id);oe(async()=>{await F(),await Promise.all([W(),E()])});async function F(){C.value=!0;const o=await re(g.value);if(!o){y.push("/404");return}const t=Array.isArray(o.author)?o.author[0]:o.author,u=o.media||o.post_media||[];let l=Array.isArray(o.workout_completion)?o.workout_completion[0]??null:o.workout_completion??null;if(l){const m=Array.isArray(l.assignment)?l.assignment[0]??null:l.assignment??null;m&&(m.workout=Array.isArray(m.workout)?m.workout[0]??null:m.workout??null),l={...l,assignment:m}}if(s.value={...o,author:t,media:u,workout_completion:l},h.value=s.value.likes_count||0,s.value.post_type==="workout"&&l){const{data:m}=await j.from("exercise_results").select(`
        id, completion_id, is_pb,
        exercise:exercises!exercise_results_exercise_id_fkey(
          id, name, sets, reps, weight_kg, duration_seconds, distance_meters
        )
      `).eq("completion_id",l.id);if(m){for(const S of m)Array.isArray(S.exercise)&&(S.exercise=S.exercise[0]??null);const A=l.shared_exercise_ids;let T=m;A&&A.length>0&&(T=m.filter(S=>A.includes(S.exercise?.id))),s.value.workout_completion.exercise_results=T}}C.value=!1}async function W(){p.value=!0,_.value=await ie(g.value),p.value=!1}async function E(){if(!i.user)return;const{data:o}=await j.from("likes").select("id").eq("user_id",i.user.id).eq("post_id",g.value).maybeSingle();f.value=!!o}async function G(){if(M.value||!i.user)return;M.value=!0;const o=f.value;f.value=!o,h.value+=o?-1:1;try{o?await j.from("likes").delete().eq("user_id",i.user.id).eq("post_id",g.value):await j.from("likes").insert({user_id:i.user.id,post_id:g.value})}catch{f.value=o,h.value+=o?1:-1}finally{M.value=!1}}async function O(o){if(!i.user)return;v.value=!0;const t=await ce(g.value,i.user.id,o);t&&(_.value.push(t),h.value=h.value,s.value&&(s.value.comments_count=(s.value.comments_count||0)+1)),v.value=!1}async function Y(o){await me(o,g.value)&&(_.value=_.value.filter(u=>u.id!==o),s.value&&(s.value.comments_count=Math.max(0,(s.value.comments_count||1)-1)))}async function J(){if(!i.user||!s.value)return;r.value=!0,await de(g.value,i.user.id)?y.replace("/profile"):(r.value=!1,c.value=!1)}const L=$(()=>{if(!s.value)return null;switch(s.value.post_type){case"workout":return{label:"Workout",class:"bg-summit-100 text-summit-800"};case"pr":return{label:"PR",class:"bg-amber-100 text-amber-800"};case"streak_milestone":return{label:"Streak",class:"bg-valencia-100 text-valencia-800"};case"achievement":return{label:"Achievement",class:"bg-green-100 text-green-800"};default:return null}}),K=$(()=>{if(!s.value)return"";const o=new Date,t=new Date(s.value.created_at),u=o.getTime()-t.getTime(),l=Math.floor(u/6e4),m=Math.floor(u/36e5),A=Math.floor(u/864e5);return l<1?"just now":l<60?`${l}m ago`:m<24?`${m}h ago`:A<7?`${A}d ago`:t.toLocaleDateString("en-US",{month:"short",day:"numeric"})}),Q=$(()=>s.value?.author?s.value.author.display_name.split(" ").map(o=>o[0]).join("").toUpperCase().slice(0,2):"?"),X=$(()=>{const o=s.value?.workout_completion;if(!o)return null;const t=o.share_settings??{show_duration:!0,show_rpe:!0,show_workout_name:!0,show_exercise_details:!0,highlight_pbs_only:!1},u=(o.exercise_results??[]).map(l=>({name:l.exercise.name,sets:l.exercise.sets,reps:l.exercise.reps,weight:l.exercise.weight_kg,duration:l.exercise.duration_seconds,distance:l.exercise.distance_meters,isPb:l.is_pb}));return{workoutName:o.assignment?.workout?.name??"Workout",duration:o.duration_minutes,completedAt:o.completed_at,exercises:u,shareSettings:t,overallRpe:o.overall_rpe,pbCount:u.filter(l=>l.isPb).length}}),Z=$(()=>s.value?.media&&s.value.media.length>0);return(o,t)=>(a(),n(z,null,[C.value?(a(),n("div",Pe,[...t[7]||(t[7]=[ae('<div class="animate-pulse space-y-4"><div class="flex items-center gap-3"><div class="w-10 h-10 rounded-full bg-gray-200"></div><div class="space-y-2 flex-1"><div class="h-4 w-24 bg-gray-200 rounded"></div><div class="h-3 w-16 bg-gray-200 rounded"></div></div></div><div class="aspect-square bg-gray-200 rounded-xl"></div><div class="h-4 w-full bg-gray-200 rounded"></div></div>',1)])])):s.value?(a(),n("div",Be,[e("div",Te,[e("div",Ue,[e("button",{onClick:t[0]||(t[0]=u=>w(y).back()),class:"text-gray-600 hover:text-gray-900 p-1"},[...t[8]||(t[8]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 19l-7-7 7-7"})],-1)])]),t[10]||(t[10]=e("h1",{class:"font-display font-semibold text-gray-900"},"Post",-1)),e("div",Ve,[H.value?(a(),n("button",{key:0,onClick:t[1]||(t[1]=u=>c.value=!0),class:"text-gray-400 hover:text-red-500 p-1 transition-colors"},[...t[9]||(t[9]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])])):b("",!0)])])]),e("header",qe,[e("button",{onClick:t[2]||(t[2]=u=>w(y).push(`/profile/${s.value.author.username}`)),class:"flex-shrink-0"},[s.value.author.avatar_url?(a(),n("img",{key:0,src:s.value.author.avatar_url,alt:s.value.author.display_name,class:"post-avatar"},null,8,Ne)):(a(),n("div",ze,d(Q.value),1))]),e("div",Ie,[e("button",{onClick:t[3]||(t[3]=u=>w(y).push(`/profile/${s.value.author.username}`)),class:"block text-left"},[e("p",Re,d(s.value.author.display_name),1),e("p",He,"@"+d(s.value.author.username),1)])]),e("div",Fe,[L.value?(a(),n("span",{key:0,class:U(["inline-flex items-center px-2 py-0.5 rounded-full text-xs font-semibold",L.value.class])},d(L.value.label),3)):b("",!0),e("span",null,d(K.value),1)])]),Z.value?(a(),V(ue,{key:0,media:s.value.media,"post-type":s.value.post_type,"workout-card-data":X.value},null,8,["media","post-type","workout-card-data"])):b("",!0),e("div",We,[e("button",{onClick:G,class:U(["post-action-btn",{"text-red-500":f.value}])},[(a(),n("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-6 h-6",fill:f.value?"currentColor":"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[...t[11]||(t[11]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"},null,-1)])],8,Ee))],2),t[12]||(t[12]=e("div",{class:"post-action-btn text-summit-700"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})])],-1)),t[13]||(t[13]=e("div",{class:"flex-1"},null,-1))]),e("div",Ge,[h.value>0?(a(),n("p",Oe,d(h.value.toLocaleString())+" "+d(h.value===1?"like":"likes"),1)):b("",!0),s.value.content?(a(),n("p",Ye,[e("button",{onClick:t[4]||(t[4]=u=>w(y).push(`/profile/${s.value.author.username}`)),class:"font-semibold hover:underline"},d(s.value.author.username),1),e("span",Je,d(s.value.content),1)])):b("",!0)]),e("div",Ke,[e("div",Qe,[e("h3",Xe,[t[14]||(t[14]=q(" Comments ",-1)),_.value.length>0?(a(),n("span",Ze,"("+d(_.value.length)+")",1)):b("",!0)])]),N($e,{comments:_.value,loading:p.value,onDelete:Y},null,8,["comments","loading"]),N(Le,{"post-id":g.value,loading:v.value,onSubmit:O},null,8,["post-id","loading"])])])):b("",!0),(a(),V(ne,{to:"body"},[c.value?(a(),n("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50",onClick:t[6]||(t[6]=R(u=>c.value=!1,["self"]))},[e("div",et,[t[16]||(t[16]=e("h3",{class:"text-lg font-semibold text-gray-900 mb-2"},"Delete Post?",-1)),t[17]||(t[17]=e("p",{class:"text-sm text-gray-600 mb-6"}," Are you sure you want to delete this post? This action cannot be undone. ",-1)),e("div",tt,[e("button",{onClick:t[5]||(t[5]=u=>c.value=!1),class:"flex-1 btn-secondary",disabled:r.value}," Cancel ",8,st),e("button",{onClick:J,class:"flex-1 btn bg-red-600 text-white hover:bg-red-700 focus:ring-red-500",disabled:r.value},[r.value?(a(),n("span",at,[...t[15]||(t[15]=[e("div",{class:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"},null,-1),q(" Deleting... ",-1)])])):(a(),n("span",nt,"Delete"))],8,ot)])])])):b("",!0)]))],64))}});export{ut as default};
