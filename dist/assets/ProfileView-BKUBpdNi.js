import{d as U,u as H,m as O,c as o,p as T,g as X,a as t,b as d,r as _,o as s,s as k,t as c,f as M,F as z,n as S,z as E,i as N,h as R,l as Z,k as ee,q as V,j as te}from"./index-CR_8Ibs2.js";import{g as se}from"./streaks-sQ-aq7wy.js";import{_ as oe,P as ae}from"./PostSkeleton-95Ry89Ga.js";import{g as re,u as le,f as ne}from"./MediaCarousel.vue_vue_type_script_setup_true_lang-BlmED56j.js";import"./WorkoutCard.vue_vue_type_script_setup_true_lang-DRkSk4fJ.js";const ie=["disabled"],ue={key:0,class:"flex items-center gap-1"},ce={key:1},de={key:2},pe={key:3},me=U({__name:"FollowButton",props:{userId:{},isPrivate:{type:Boolean},size:{}},emits:["change"],setup(D,{emit:b}){const x=D,w=b,y=H(),a=_(!1),u=_(!1),g=_(!1);O(async()=>{if(!y.user||y.user.id===x.userId)return;const i=await re(y.user.id,x.userId);a.value=i.isFollowing&&i.status==="active",u.value=i.isFollowing&&i.status==="pending"});async function q(){if(!(!y.user||g.value)){g.value=!0;try{a.value||u.value?await le(y.user.id,x.userId)&&(a.value=!1,u.value=!1,w("change",!1)):await ne(y.user.id,x.userId,x.isPrivate??!1)&&(x.isPrivate?u.value=!0:a.value=!0,w("change",!0))}catch(i){console.error("Error toggling follow:",i)}finally{g.value=!1}}}const C=y.user?.id===x.userId;return(i,j)=>C?d("",!0):(s(),o("button",{key:0,onClick:X(q,["stop"]),disabled:g.value,class:T(["font-medium rounded-xl transition-all duration-200 disabled:opacity-50",[a.value?"bg-gray-100 text-gray-700 hover:bg-red-50 hover:text-red-600 border border-gray-200":u.value?"bg-gray-100 text-gray-600 border border-gray-200":"bg-summit-800 text-white hover:bg-summit-700",D.size==="sm"?"px-3 py-1.5 text-xs":"px-4 py-2 text-sm"]])},[g.value?(s(),o("span",ue,[...j[0]||(j[0]=[t("div",{class:"w-3 h-3 border-2 border-current border-t-transparent rounded-full animate-spin"},null,-1)])])):a.value?(s(),o("span",ce,"Following")):u.value?(s(),o("span",de,"Requested")):(s(),o("span",pe,"Follow"))],10,ie))}}),fe={key:0,class:"p-6 text-center"},ve={key:1,class:"pb-20"},_e={class:"p-6 text-center"},ge={class:"w-24 h-24 mx-auto mb-4"},we=["src","alt"],ye={key:1,class:"w-full h-full rounded-full bg-gradient-to-br from-summit-600 to-summit-800 flex items-center justify-center text-white font-bold text-2xl ring-4 ring-white shadow-lg"},xe={class:"font-display text-2xl font-bold text-gray-900"},he={class:"text-gray-500"},ke={class:"mt-2"},be={key:0,class:"mt-3 inline-flex items-center gap-2 px-4 py-2 bg-valencia-50 border border-valencia-200 rounded-full"},Ce={class:"font-semibold text-valencia-700"},Pe={key:0,class:"text-sm text-gray-500"},Me={key:1,class:"mt-4 text-gray-700 max-w-sm mx-auto"},qe={key:2,class:"mt-4 max-w-sm mx-auto text-left bg-gray-50 rounded-xl p-4 space-y-3"},je={key:0},Ae={class:"text-sm text-gray-700"},Be={key:1,class:"flex gap-4 text-sm text-gray-600"},Fe={key:0,class:"flex items-center gap-1"},ze={key:1,class:"flex items-center gap-1"},De={key:2},Le={class:"flex flex-wrap gap-2"},Se=["href"],Ee={key:4},Ve={class:"mt-6 flex gap-3 justify-center"},$e={class:"flex justify-center gap-8 py-4 border-y border-feed-border"},Ie={class:"text-center"},Ne={class:"font-bold text-gray-900"},Re={class:"text-center"},Ue={class:"font-bold text-gray-900"},He={class:"text-center"},Oe={class:"font-bold text-gray-900"},Te={class:"px-4 py-4"},Qe={key:0,class:"space-y-4"},Ye={key:1,class:"p-6 text-center text-gray-500"},Ge={key:2,class:"space-y-4"},et=U({__name:"ProfileView",setup(D){const b=Z(),x=ee(),w=H(),y=_(null),a=_(null),u=_(null),g=_([]),q=_(!1),C=_(0),i=_(0),j=_(0),B=_(!0),P=V(()=>b.params.username?b.params.username===w.profile?.username:!0),l=V(()=>P.value?w.profile:y.value),Q=V(()=>l.value?l.value.display_name.split(" ").map(n=>n[0]).join("").toUpperCase().slice(0,2):"?");O(async()=>{!P.value&&b.params.username?await Y(b.params.username):(B.value=!1,w.isCoach&&w.user&&await $(w.user.id),w.user&&await I(w.user.id))});async function Y(n){try{B.value=!0;const{data:e,error:v}=await k.from("profiles").select("*").eq("username",n).single();if(v||!e)throw v||new Error("Profile not found");y.value=e,e.user_type==="coach"&&await $(e.id),await I(e.id)}catch(e){console.error("Error fetching profile:",e),x.push("/404")}finally{B.value=!1}}async function $(n){try{const{data:e,error:v}=await k.from("coach_profiles").select("*").eq("id",n).single();if(v)throw v;a.value=e}catch(e){console.error("Error fetching coach info:",e)}}async function I(n){const[e,,v,p,F]=await Promise.all([se(n),K(n),k.from("posts").select("id",{count:"exact",head:!0}).eq("author_id",n),k.from("follows").select("id",{count:"exact",head:!0}).eq("following_id",n).eq("status","active"),k.from("follows").select("id",{count:"exact",head:!0}).eq("follower_id",n).eq("status","active")]);u.value=e,C.value=v.count||0,i.value=p.count||0,j.value=F.count||0}function G(n){n?i.value++:i.value=Math.max(0,i.value-1)}function J(n){g.value=g.value.filter(e=>e.id!==n),C.value=Math.max(0,C.value-1)}async function K(n){q.value=!0;try{let e=k.from("posts").select(`
        *,
        author:profiles!author_id(*),
        media:post_media(*),
        workout_completion:workout_completions!posts_workout_completion_id_fkey(
          id, duration_minutes, overall_rpe, has_pb, completed_at,
          shared_exercise_ids, share_settings,
          assignment:workout_assignments!workout_completions_assignment_id_fkey(
            workout:workouts!workout_assignments_workout_id_fkey(id, name, description)
          )
        )
      `).eq("author_id",n).order("created_at",{ascending:!1}).limit(20);P.value||(e=e.eq("visibility","public"));const{data:v}=await e,p=(v||[]).map(m=>{const A=Array.isArray(m.author)?m.author[0]:m.author,h=m.media||[];let r=Array.isArray(m.workout_completion)?m.workout_completion[0]??null:m.workout_completion??null;if(r){const f=Array.isArray(r.assignment)?r.assignment[0]??null:r.assignment??null;f&&(f.workout=Array.isArray(f.workout)?f.workout[0]??null:f.workout??null),r={...r,assignment:f}}return{...m,author:A,media:h,workout_completion:r}}),F=p.filter(m=>m.post_type==="workout"&&m.workout_completion);if(F.length>0){const m=F.map(h=>h.workout_completion.id),{data:A}=await k.from("exercise_results").select(`
          id, completion_id, is_pb,
          exercise:exercises!exercise_results_exercise_id_fkey(
            id, name, sets, reps, weight_kg, duration_seconds, distance_meters
          )
        `).in("completion_id",m);if(A){for(const r of A)Array.isArray(r.exercise)&&(r.exercise=r.exercise[0]??null);const h=new Map;for(const r of A){const f=h.get(r.completion_id)||[];f.push(r),h.set(r.completion_id,f)}for(const r of p)if(r.workout_completion){const f=r.workout_completion.shared_exercise_ids;let L=h.get(r.workout_completion.id)||[];f&&f.length>0&&(L=L.filter(W=>f.includes(W.exercise?.id))),r.workout_completion.exercise_results=L}}}g.value=p}catch(e){console.error("Error loading posts:",e)}finally{q.value=!1}}return(n,e)=>{const v=te("router-link");return B.value?(s(),o("div",fe,[...e[0]||(e[0]=[t("div",{class:"animate-pulse space-y-4"},[t("div",{class:"w-24 h-24 mx-auto rounded-full bg-gray-200"}),t("div",{class:"h-6 w-32 mx-auto bg-gray-200 rounded"}),t("div",{class:"h-4 w-24 mx-auto bg-gray-200 rounded"})],-1)])])):l.value?(s(),o("div",ve,[t("div",_e,[t("div",ge,[l.value.avatar_url?(s(),o("img",{key:0,src:l.value.avatar_url,alt:l.value.display_name,class:"w-full h-full rounded-full object-cover ring-4 ring-white shadow-lg"},null,8,we)):(s(),o("div",ye,c(Q.value),1))]),t("h1",xe,c(l.value.display_name),1),t("p",he,"@"+c(l.value.username),1),t("div",ke,[t("span",{class:T(["badge",{"badge-coach":l.value.user_type==="coach","bg-blue-100 text-blue-700":l.value.user_type==="athlete","bg-gray-100 text-gray-700":l.value.user_type==="follower"}])},c(l.value.user_type.charAt(0).toUpperCase()+l.value.user_type.slice(1)),3)]),u.value&&u.value.current_streak>0?(s(),o("div",be,[e[1]||(e[1]=t("span",{class:"text-valencia-600 text-lg"},"ðŸ”¥",-1)),t("span",Ce,c(u.value.current_streak)+" day streak",1),u.value.longest_streak>u.value.current_streak?(s(),o("span",Pe," (best: "+c(u.value.longest_streak)+") ",1)):d("",!0)])):d("",!0),l.value.bio?(s(),o("p",Me,c(l.value.bio),1)):d("",!0),l.value.user_type==="coach"&&a.value?(s(),o("div",qe,[a.value.qualifications?(s(),o("div",je,[e[2]||(e[2]=t("p",{class:"text-xs font-semibold text-gray-500 uppercase tracking-wide mb-1"},"Qualifications",-1)),t("p",Ae,c(a.value.qualifications),1)])):d("",!0),a.value.experience_years||a.value.location?(s(),o("div",Be,[a.value.experience_years?(s(),o("span",Fe,[e[3]||(e[3]=t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),M(" "+c(a.value.experience_years)+" years ",1)])):d("",!0),a.value.location?(s(),o("span",ze,[e[4]||(e[4]=t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})],-1)),M(" "+c(a.value.location),1)])):d("",!0)])):d("",!0),a.value.specialties&&a.value.specialties.length>0?(s(),o("div",De,[e[5]||(e[5]=t("p",{class:"text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2"},"Specialties",-1)),t("div",Le,[(s(!0),o(z,null,S(a.value.specialties,p=>(s(),o("span",{key:p,class:"px-2 py-1 bg-summit-100 text-summit-800 rounded-full text-xs font-medium"},c(p),1))),128))])])):d("",!0),a.value.website_url?(s(),o("a",{key:3,href:a.value.website_url,target:"_blank",rel:"noopener noreferrer",class:"text-sm text-summit-700 hover:text-summit-800 inline-flex items-center gap-1 transition-colors"},[...e[6]||(e[6]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9"})],-1),M(" Visit website ",-1),t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})],-1)])],8,Se)):d("",!0),a.value.accepts_athletes&&!P.value?(s(),o("div",Ee,[...e[7]||(e[7]=[t("span",{class:"inline-flex items-center gap-1 px-3 py-1 bg-green-100 text-green-700 rounded-full text-sm font-medium"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M5 13l4 4L19 7"})]),M(" Accepting new athletes ")],-1)])])):d("",!0)])):d("",!0),t("div",Ve,[P.value?(s(),E(v,{key:0,to:"/settings",class:"btn-secondary"},{default:N(()=>[...e[8]||(e[8]=[M(" Edit Profile ",-1)])]),_:1})):(s(),o(z,{key:1},[R(me,{"user-id":l.value.id,"is-private":l.value.is_private,onChange:G},null,8,["user-id","is-private"]),e[9]||(e[9]=t("button",{class:"btn-secondary"},"Message",-1))],64))])]),t("div",$e,[t("div",Ie,[t("p",Ne,c(C.value),1),e[10]||(e[10]=t("p",{class:"text-sm text-gray-500"},"Posts",-1))]),t("div",Re,[t("p",Ue,c(i.value),1),e[11]||(e[11]=t("p",{class:"text-sm text-gray-500"},"Followers",-1))]),t("div",He,[t("p",Oe,c(j.value),1),e[12]||(e[12]=t("p",{class:"text-sm text-gray-500"},"Following",-1))])]),t("div",Te,[q.value?(s(),o("div",Qe,[(s(),o(z,null,S(2,p=>R(ae,{key:p})),64))])):g.value.length===0?(s(),o("div",Ye,[e[14]||(e[14]=t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-12 h-12 mx-auto mb-3 text-gray-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"1.5"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)),e[15]||(e[15]=t("p",null,"No posts yet",-1)),P.value?(s(),E(v,{key:0,to:"/create",class:"mt-3 inline-block btn-primary"},{default:N(()=>[...e[13]||(e[13]=[M(" Create Your First Post ",-1)])]),_:1})):d("",!0)])):(s(),o("div",Ge,[(s(!0),o(z,null,S(g.value,p=>(s(),E(oe,{key:p.id,post:p,onDeleted:J},null,8,["post"]))),128))]))])])):d("",!0)}}});export{et as default};
