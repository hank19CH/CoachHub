import{s as k,d as C,u as I,m as j,c as o,a as t,t as f,h as x,i as b,f as i,b as c,l as A,r as d,j as B,o as s,k as N}from"./index-DoIKaNgo.js";import{l as V,a as E}from"./athletes-Bm142xSv.js";async function M(g){const{data:m,error:a}=await k.from("profiles").select("id, username, display_name, avatar_url, bio, user_type").eq("id",g).eq("user_type","coach").single();if(a)throw console.error("Error fetching coach profile:",a),new Error("Coach not found");return m}const S={class:"min-h-screen bg-gradient-to-br from-summit-600 to-valencia-600 flex items-center justify-center p-4"},q={key:0,class:"text-center"},H={key:1,class:"bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full text-center"},L={class:"text-gray-600 mb-6"},z={key:2,class:"bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full"},D={class:"text-center mb-6"},G=["src","alt"],P={class:"text-gray-600"},R={class:"font-semibold text-summit-600"},T={key:0,class:"bg-gray-50 rounded-lg p-4 mb-6"},Y={class:"text-sm text-gray-700 italic"},F={key:1,class:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6"},J={key:2,class:"space-y-3"},K={key:3},O={key:4,class:"text-center mt-6"},W=C({__name:"InviteAcceptanceView",setup(g){const m=A(),a=N(),v=I(),w=d(!0),p=d(null),n=d(null),r=d(""),l=d(!1);j(async()=>{try{if(r.value=m.params.code,!r.value)throw new Error("No invite code provided");const u=await V(r.value);if(!u)throw new Error("Invalid or expired invite code");if(n.value=await M(u.coach_id),v.profile?.id&&v.profile.user_type==="athlete")try{await E(r.value,v.profile.id),l.value=!0}catch{l.value=!0}}catch(u){p.value=u.message||"This invitation link is invalid or has expired"}finally{w.value=!1}});function y(){sessionStorage.setItem("pending_invite_code",r.value),a.push({name:"signup",query:{invite:r.value}})}function _(){sessionStorage.setItem("pending_invite_code",r.value),a.push({name:"login",query:{invite:"true"}})}return(u,e)=>{const h=B("router-link");return s(),o("div",S,[w.value?(s(),o("div",q,[...e[0]||(e[0]=[t("div",{class:"animate-spin rounded-full h-16 w-16 border-b-2 border-white mx-auto"},null,-1),t("p",{class:"text-white mt-4"},"Loading invitation...",-1)])])):p.value?(s(),o("div",H,[e[2]||(e[2]=t("svg",{class:"w-16 h-16 text-red-500 mx-auto mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})],-1)),e[3]||(e[3]=t("h2",{class:"text-2xl font-bold text-gray-900 mb-2"},"Invalid Invitation",-1)),t("p",L,f(p.value),1),x(h,{to:"/",class:"inline-block bg-summit-600 text-white px-6 py-3 rounded-lg hover:bg-summit-700 transition"},{default:b(()=>[...e[1]||(e[1]=[i(" Go to Home ",-1)])]),_:1})])):n.value?(s(),o("div",z,[t("div",D,[t("img",{src:n.value.avatar_url||"https://via.placeholder.com/120",alt:n.value.display_name,class:"w-24 h-24 rounded-full mx-auto mb-4 object-cover border-4 border-summit-100"},null,8,G),e[5]||(e[5]=t("h2",{class:"text-2xl font-bold text-gray-900 mb-1"}," You're Invited! ",-1)),t("p",P,[t("span",R,f(n.value.display_name),1),e[4]||(e[4]=i(" has invited you to train with them ",-1))])]),n.value.bio?(s(),o("div",T,[t("p",Y,'"'+f(n.value.bio)+'"',1)])):c("",!0),l.value?(s(),o("div",F,[...e[6]||(e[6]=[t("p",{class:"text-sm text-blue-800"}," You're already connected with this coach! ",-1)])])):c("",!0),l.value?(s(),o("div",K,[x(h,{to:"/athlete/hub",class:"block w-full bg-summit-600 text-white px-6 py-3 rounded-lg hover:bg-summit-700 transition font-medium text-center"},{default:b(()=>[...e[9]||(e[9]=[i(" Go to Dashboard ",-1)])]),_:1})])):(s(),o("div",J,[t("button",{onClick:y,class:"w-full bg-summit-600 text-white px-6 py-3 rounded-lg hover:bg-summit-700 transition font-medium flex items-center justify-center gap-2"},[...e[7]||(e[7]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"})],-1),i(" Create Account & Accept ",-1)])]),t("button",{onClick:_,class:"w-full bg-white text-summit-600 px-6 py-3 rounded-lg hover:bg-gray-50 transition font-medium border-2 border-summit-600 flex items-center justify-center gap-2"},[...e[8]||(e[8]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1"})],-1),i(" I Have an Account ",-1)])])])),l.value?c("",!0):(s(),o("div",O,[x(h,{to:"/",class:"text-sm text-gray-500 hover:text-gray-700"},{default:b(()=>[...e[10]||(e[10]=[i(" No thanks, take me home ",-1)])]),_:1})]))])):c("",!0)])}}});export{W as default};
